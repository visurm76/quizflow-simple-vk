{"version":3,"sources":["../../../src/components/CalendarDays/CalendarDays.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { classNames, isSameDate } from '@vkontakte/vkjs';\nimport { useTodayDate } from '../../hooks/useTodayDate';\nimport { getDaysNames, getWeeks } from '../../lib/calendar';\nimport { isSameMonth } from '../../lib/date';\nimport type { HTMLAttributesWithRootRef } from '../../types';\nimport {\n  CalendarDay,\n  type CalendarDayElementProps,\n  type CalendarDayProps,\n  type CalendarDayTestsProps,\n} from '../CalendarDay/CalendarDay';\nimport { useConfigProvider } from '../ConfigProvider/ConfigProviderContext';\nimport { RootComponent } from '../RootComponent/RootComponent';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden';\nimport styles from './CalendarDays.module.css';\n\nexport type CalendarDaysTestsProps = {\n  /**\n   * Передает атрибут `data-testid` для дня в календаре.\n   */\n  dayTestId?: CalendarDayTestsProps['testId'];\n};\n\nexport interface CalendarDaysProps\n  extends Omit<HTMLAttributesWithRootRef<HTMLDivElement>, 'onChange'>,\n    Pick<CalendarDayProps, 'renderDayContent'>,\n    CalendarDaysTestsProps {\n  /**\n   * Выбранная дата или диапазон дат.\n   */\n  value?: Date | Array<Date | null> | null;\n  /**\n   * Дата, определяющая отображаемый месяц.\n   */\n  viewDate: Date;\n  /**\n   * День недели, с которого начинается неделя (0 - воскресенье, 6 - суббота).\n   */\n  weekStartsOn: 0 | 1 | 2 | 3 | 4 | 5 | 6;\n  /**\n   * Показывать дни соседних месяцев.\n   */\n  showNeighboringMonth?: boolean;\n  /**\n   * Размер календаря.\n   */\n  size?: 's' | 'm';\n  /**\n   * Дополнительные свойства для элементов дней.\n   */\n  dayProps?: CalendarDayElementProps;\n  /**\n   * Следить за изменениями дней для обновления UI.\n   */\n  listenDayChangesForUpdate?: boolean;\n  /**\n   * Обработчик изменения выбранного дня.\n   */\n  onDayChange: (value: Date) => void;\n  /**\n   * Проверяет, заблокирован ли день для выбора.\n   */\n  isDayDisabled: (value: Date) => boolean;\n  /**\n   * Определяет, является ли день началом выделенного диапазона.\n   */\n  isDaySelectionStart: (value: Date, dayOfWeek: number) => boolean;\n  /**\n   * Определяет, является ли день концом выделенного диапазона.\n   */\n  isDaySelectionEnd: (value: Date, dayOfWeek: number) => boolean;\n  /**\n   * Определяет начало диапазона при наведении (подсветка).\n   */\n  isHintedDaySelectionStart?: (value: Date, dayOfWeek: number) => boolean;\n  /**\n   * Определяет конец диапазона при наведении (подсветка).\n   */\n  isHintedDaySelectionEnd?: (value: Date, dayOfWeek: number) => boolean;\n  /**\n   * Проверяет, является ли день активным (текущая дата).\n   */\n  isDayActive: (value: Date) => boolean;\n  /**\n   * Проверяет, подсвечен ли день (при наведении).\n   */\n  isDayHinted?: (value: Date) => boolean;\n  /**\n   * Проверяет, возможно ли сфокусироваться на дне с клавиатуры.\n   */\n  isDayFocusable?: (value: Date) => boolean;\n  /**\n   * Проверяет, выбран ли день.\n   */\n  isDaySelected?: (value: Date) => boolean;\n  /**\n   * Проверяет, находится ли день в фокусе.\n   */\n  isDayFocused: (value: Date) => boolean;\n  /**\n   * Обработчик события 'pointerenter' на элементе дня.\n   */\n  onDayEnter?: (value: Date) => void;\n  /**\n   * Обработчик события 'pointerleave' на элементе дня.\n   */\n  onDayLeave?: (value: Date) => void;\n  /**\n   * Обработчик события `focus` на элементе дня.\n   */\n  onDayFocus?: (value: Date) => void;\n}\n\nexport const CalendarDays = ({\n  viewDate,\n  value,\n  weekStartsOn,\n  onDayChange,\n  isDaySelected,\n  isDayActive,\n  isDaySelectionEnd,\n  isDaySelectionStart,\n  onDayEnter,\n  onDayLeave,\n  onDayFocus,\n  isDayHinted,\n  isHintedDaySelectionStart,\n  isHintedDaySelectionEnd,\n  isDayFocused,\n  isDayFocusable,\n  isDayDisabled,\n  size,\n  showNeighboringMonth = false,\n  dayProps,\n  listenDayChangesForUpdate = false,\n  getRootRef,\n  renderDayContent,\n  dayTestId,\n  ...props\n}: CalendarDaysProps): React.ReactNode => {\n  const { locale } = useConfigProvider();\n  const now = useTodayDate(listenDayChangesForUpdate);\n\n  const weeks = React.useMemo(() => getWeeks(viewDate, weekStartsOn), [weekStartsOn, viewDate]);\n\n  const daysNames = React.useMemo(\n    () => getDaysNames(now, weekStartsOn, locale),\n    [locale, now, weekStartsOn],\n  );\n\n  const handleDayChange = React.useCallback(\n    (date: Date) => {\n      onDayChange(date);\n    },\n    [onDayChange],\n  );\n\n  const viewDateLabelId = React.useId();\n  const currentMonthLabel = value\n    ? new Intl.DateTimeFormat(locale, {\n        year: 'numeric',\n        month: 'long',\n      }).format(viewDate)\n    : null;\n\n  return (\n    <React.Fragment>\n      {/*\n       * Нельзя помещать текст currentMonthLabel внутрь role=\"grid\" или с помощью aria-label,\n       * иначе пользователи NVDA не смогут ходить по таблице\n       * с помощью горячих клавиш <Ctrl+Alt+стрелочки>.\n       * Имеется ввиду связка (применение которой визуально не видно):\n       * - из заголовка календаря прыжок в таблицу с помощью клавиши <T>\n       * - переход по ячейкам с помощью <Ctrl+Alrt+стрелочки>\n       * NVDA будет говорить, что пользователь вне ячейки таблицы.\n       * Также важно оставить aria-live=\"polite\". Так NVDA зачитывает текущий\n       * месяц и год при переключении месяца и года в заголовке календаря.\n       */}\n      <VisuallyHidden aria-live=\"polite\" id={viewDateLabelId}>\n        {currentMonthLabel}\n      </VisuallyHidden>\n      <RootComponent\n        role=\"grid\"\n        {...props}\n        baseClassName={styles.host}\n        aria-labelledby={viewDateLabelId}\n      >\n        <div\n          role=\"row\"\n          aria-rowindex={1}\n          className={classNames(styles.row, size === 's' && styles.rowSizeS)}\n        >\n          {daysNames.map(({ short: shortDayName, long: longDayName }) => (\n            <Footnote\n              role=\"columnheader\"\n              aria-label={longDayName}\n              key={shortDayName}\n              className={styles.weekday}\n            >\n              {shortDayName}\n            </Footnote>\n          ))}\n        </div>\n\n        {weeks.map((week, i) => (\n          <div\n            role=\"row\"\n            aria-rowindex={i + 2}\n            className={classNames(styles.row, size === 's' && styles.rowSizeS)}\n            key={i}\n          >\n            {week.map((day, i) => {\n              const sameMonth = isSameMonth(day, viewDate);\n              const isHidden = !showNeighboringMonth && !sameMonth;\n              const isToday = isSameDate(day, now);\n              const isActive = isDayActive(day);\n              const isFocused = isDayFocused(day);\n              return (\n                <CalendarDay\n                  role=\"gridcell\"\n                  aria-current={isToday ? 'date' : undefined}\n                  aria-selected={isActive ? 'true' : 'false'}\n                  aria-colindex={i + 1}\n                  tabIndex={isDayFocusable?.(day) ? 0 : -1}\n                  key={day.toISOString()}\n                  day={day}\n                  today={isToday}\n                  active={isActive}\n                  onChange={handleDayChange}\n                  hidden={isHidden}\n                  disabled={isDayDisabled(day)}\n                  selectionStart={isDaySelectionStart(day, i)}\n                  selectionEnd={isDaySelectionEnd(day, i)}\n                  hintedSelectionStart={isHintedDaySelectionStart?.(day, i)}\n                  hintedSelectionEnd={isHintedDaySelectionEnd?.(day, i)}\n                  selected={isDaySelected?.(day)}\n                  focused={isFocused}\n                  onEnter={onDayEnter}\n                  onLeave={onDayLeave}\n                  onFocus={onDayFocus}\n                  hinted={isDayHinted?.(day)}\n                  sameMonth={sameMonth}\n                  size={size}\n                  renderDayContent={renderDayContent}\n                  testId={dayTestId}\n                  {...dayProps}\n                  className={classNames(dayProps?.className, styles.rowDay)}\n                />\n              );\n            })}\n          </div>\n        ))}\n      </RootComponent>\n    </React.Fragment>\n  );\n};\n"],"names":["React","classNames","isSameDate","useTodayDate","getDaysNames","getWeeks","isSameMonth","CalendarDay","useConfigProvider","RootComponent","Footnote","VisuallyHidden","CalendarDays","viewDate","value","weekStartsOn","onDayChange","isDaySelected","isDayActive","isDaySelectionEnd","isDaySelectionStart","onDayEnter","onDayLeave","onDayFocus","isDayHinted","isHintedDaySelectionStart","isHintedDaySelectionEnd","isDayFocused","isDayFocusable","isDayDisabled","size","showNeighboringMonth","dayProps","listenDayChangesForUpdate","getRootRef","renderDayContent","dayTestId","props","locale","now","weeks","useMemo","daysNames","handleDayChange","useCallback","date","viewDateLabelId","useId","currentMonthLabel","Intl","DateTimeFormat","year","month","format","Fragment","aria-live","id","role","baseClassName","aria-labelledby","div","aria-rowindex","className","map","short","shortDayName","long","longDayName","aria-label","week","i","day","sameMonth","isHidden","isToday","isActive","isFocused","aria-current","undefined","aria-selected","aria-colindex","tabIndex","today","active","onChange","hidden","disabled","selectionStart","selectionEnd","hintedSelectionStart","hintedSelectionEnd","selected","focused","onEnter","onLeave","onFocus","hinted","testId","toISOString"],"mappings":"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"}