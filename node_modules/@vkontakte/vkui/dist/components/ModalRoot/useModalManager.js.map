{"version":3,"sources":["../../../src/components/ModalRoot/useModalManager.tsx"],"sourcesContent":["/* eslint-disable jsdoc/require-jsdoc */\n\nimport { useContext, useId, useState } from 'react';\nimport { getNavId } from '../../lib/getNavId';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../lib/warnOnce';\nimport type { AnyFunction } from '../../types';\nimport { ModalOverlay, type ModalOverlayProps } from '../ModalOverlay/ModalOverlay';\nimport { ModalRootContext } from './ModalRootContext';\nimport { VisuallyHiddenModalOverlay } from './VisuallyHiddenModalOverlay/VisuallyHiddenModalOverlay';\nimport type { ModalRootCallbackFunction } from './types';\n\nconst warn = warnOnce('useModalManager');\nexport interface UseModalManager {\n  id?: string;\n  open: boolean;\n  keepMounted: boolean;\n  modalOverlayTestId?: string;\n  noFocusToDialog?: boolean;\n  disableModalOverlay?: boolean;\n  onOpen?: AnyFunction;\n  onOpened?: AnyFunction;\n  onClose?: AnyFunction;\n  onClosed?: AnyFunction;\n}\n\nexport interface UseModalManagerResolvedProps {\n  id: string;\n  open: boolean;\n  noFocusToDialog?: boolean;\n  disableModalOverlay?: boolean;\n  modalOverlayTestId?: string;\n  ModalOverlay: React.ComponentType<ModalOverlayProps>;\n  onOpen?: AnyFunction;\n  onOpened?: AnyFunction;\n  onClose?: AnyFunction;\n  onClosed?: AnyFunction;\n}\n\nexport type UseModalManagerResult =\n  | { mounted: false; shouldPreserveSnapPoint: boolean; id: UseModalManagerResolvedProps['id'] }\n  | ({ mounted: true; shouldPreserveSnapPoint: boolean } & UseModalManagerResolvedProps);\n\nexport const useModalManager = ({\n  id: idProp,\n  open,\n  keepMounted,\n  modalOverlayTestId,\n  noFocusToDialog,\n  disableModalOverlay,\n  onOpen,\n  onOpened,\n  onClose,\n  onClosed,\n}: UseModalManager): UseModalManagerResult => {\n  const context = useContext(ModalRootContext);\n  const generatingId = useId();\n  const id = getNavId({ nav: idProp }, context.isInsideModal ? warn : undefined) || generatingId;\n  const opened = context.isInsideModal ? context.activeModal === id : open;\n  const shouldPreserveSnapPoint = context.isInsideModal ? context.activeModal !== null : false;\n\n  const [unmounted, setUnmounted] = useState(keepMounted ? false : !opened);\n\n  useIsomorphicLayoutEffect(\n    function unsetUnmounted() {\n      if (!keepMounted && opened) {\n        setUnmounted((prev) => (prev ? false : prev));\n      }\n    },\n    [opened, keepMounted],\n  );\n\n  if (unmounted) {\n    return { mounted: false, shouldPreserveSnapPoint, id };\n  }\n\n  return {\n    id,\n    mounted: true,\n    open: opened,\n    shouldPreserveSnapPoint,\n    noFocusToDialog: noFocusToDialog || context.noFocusToDialog,\n    modalOverlayTestId: modalOverlayTestId || context.modalOverlayTestId,\n    disableModalOverlay: disableModalOverlay || context.disableModalOverlay,\n    ModalOverlay: context.isInsideModal ? VisuallyHiddenModalOverlay : ModalOverlay,\n    onOpen: onOpen || getContextCallback(id, context.onOpen),\n    onOpened: onOpened || getContextCallback(id, context.onOpened),\n    onClose: onClose || getContextCallback(id, context.onClose),\n    onClosed: function handleClosed(...args: any[]) {\n      if (!keepMounted) {\n        setUnmounted(true);\n      }\n\n      if (onClosed) {\n        onClosed(...args);\n      } else {\n        context.onClosed?.(id);\n      }\n    },\n  };\n};\n\nfunction getContextCallback(id: string, fn: ModalRootCallbackFunction | undefined) {\n  return fn ? () => fn(id) : undefined;\n}\n"],"names":["useContext","useId","useState","getNavId","useIsomorphicLayoutEffect","warnOnce","ModalOverlay","ModalRootContext","VisuallyHiddenModalOverlay","warn","useModalManager","id","idProp","open","keepMounted","modalOverlayTestId","noFocusToDialog","disableModalOverlay","onOpen","onOpened","onClose","onClosed","context","generatingId","nav","isInsideModal","undefined","opened","activeModal","shouldPreserveSnapPoint","unmounted","setUnmounted","unsetUnmounted","prev","mounted","getContextCallback","handleClosed","args","fn"],"mappings":"AAAA,sCAAsC,GAEtC,SAASA,UAAU,EAAEC,KAAK,EAAEC,QAAQ,QAAQ,QAAQ;AACpD,SAASC,QAAQ,QAAQ,wBAAqB;AAC9C,SAASC,yBAAyB,QAAQ,yCAAsC;AAChF,SAASC,QAAQ,QAAQ,wBAAqB;AAE9C,SAASC,YAAY,QAAgC,kCAA+B;AACpF,SAASC,gBAAgB,QAAQ,wBAAqB;AACtD,SAASC,0BAA0B,QAAQ,6DAA0D;AAGrG,MAAMC,OAAOJ,SAAS;AA+BtB,OAAO,MAAMK,kBAAkB,CAAC,EAC9BC,IAAIC,MAAM,EACVC,IAAI,EACJC,WAAW,EACXC,kBAAkB,EAClBC,eAAe,EACfC,mBAAmB,EACnBC,MAAM,EACNC,QAAQ,EACRC,OAAO,EACPC,QAAQ,EACQ;IAChB,MAAMC,UAAUtB,WAAWO;IAC3B,MAAMgB,eAAetB;IACrB,MAAMU,KAAKR,SAAS;QAAEqB,KAAKZ;IAAO,GAAGU,QAAQG,aAAa,GAAGhB,OAAOiB,cAAcH;IAClF,MAAMI,SAASL,QAAQG,aAAa,GAAGH,QAAQM,WAAW,KAAKjB,KAAKE;IACpE,MAAMgB,0BAA0BP,QAAQG,aAAa,GAAGH,QAAQM,WAAW,KAAK,OAAO;IAEvF,MAAM,CAACE,WAAWC,aAAa,GAAG7B,SAASY,cAAc,QAAQ,CAACa;IAElEvB,0BACE,SAAS4B;QACP,IAAI,CAAClB,eAAea,QAAQ;YAC1BI,aAAa,CAACE,OAAUA,OAAO,QAAQA;QACzC;IACF,GACA;QAACN;QAAQb;KAAY;IAGvB,IAAIgB,WAAW;QACb,OAAO;YAAEI,SAAS;YAAOL;YAAyBlB;QAAG;IACvD;IAEA,OAAO;QACLA;QACAuB,SAAS;QACTrB,MAAMc;QACNE;QACAb,iBAAiBA,mBAAmBM,QAAQN,eAAe;QAC3DD,oBAAoBA,sBAAsBO,QAAQP,kBAAkB;QACpEE,qBAAqBA,uBAAuBK,QAAQL,mBAAmB;QACvEX,cAAcgB,QAAQG,aAAa,GAAGjB,6BAA6BF;QACnEY,QAAQA,UAAUiB,mBAAmBxB,IAAIW,QAAQJ,MAAM;QACvDC,UAAUA,YAAYgB,mBAAmBxB,IAAIW,QAAQH,QAAQ;QAC7DC,SAASA,WAAWe,mBAAmBxB,IAAIW,QAAQF,OAAO;QAC1DC,UAAU,SAASe,aAAa,GAAGC,IAAW;YAC5C,IAAI,CAACvB,aAAa;gBAChBiB,aAAa;YACf;YAEA,IAAIV,UAAU;gBACZA,YAAYgB;YACd,OAAO;oBACLf;iBAAAA,oBAAAA,QAAQD,QAAQ,cAAhBC,wCAAAA,uBAAAA,SAAmBX;YACrB;QACF;IACF;AACF,EAAE;AAEF,SAASwB,mBAAmBxB,EAAU,EAAE2B,EAAyC;IAC/E,OAAOA,KAAK,IAAMA,GAAG3B,MAAMe;AAC7B"}