{"version":3,"sources":["../../../src/components/CustomSelect/CustomSelect.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { getRequiredValueByKey } from '../../helpers/getValueByKey';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useMergeProps } from '../../hooks/useMergeProps';\nimport { callMultiple } from '../../lib/callMultiple';\nimport { useDOM } from '../../lib/dom';\nimport type { Placement } from '../../lib/floating';\nimport { defaultFilterFn, type FilterFn } from '../../lib/select';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { preventDefault } from '../../lib/utils';\nimport { type HasDataAttribute, type HasRootRef } from '../../types';\nimport {\n  CustomSelectDropdown,\n  type CustomSelectDropdownProps,\n} from '../CustomSelectDropdown/CustomSelectDropdown';\nimport { CustomSelectOption } from '../CustomSelectOption/CustomSelectOption';\nimport type { FormFieldProps } from '../FormField/FormField';\nimport {\n  type NativeSelectProps,\n  NOT_SELECTED,\n  remapFromNativeValueToSelectValue,\n  type SelectValue,\n} from '../NativeSelect/NativeSelect';\nimport { RootComponent } from '../RootComponent/RootComponent';\nimport type { SelectType } from '../Select/Select';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden';\nimport { type CustomSelectClearButtonProps } from './CustomSelectClearButton';\nimport {\n  CustomSelectInput,\n  type CustomSelectInputProps,\n} from './CustomSelectInput/CustomSelectInput';\nimport {\n  checkDeprecatedProps,\n  checkMixControlledAndUncontrolledState,\n  checkOptionsValueType,\n  filter,\n  findSelectedIndex,\n  getOptionByValue,\n} from './helpers';\nimport { useAfterItems } from './hooks/useAfterItems';\nimport { useDropdownOpenedController } from './hooks/useDropdownOpenedController';\nimport { useFocusedOptionController } from './hooks/useFocusedOptionController';\nimport { useInputKeyboardController } from './hooks/useInputKeyboardController';\nimport { useInputValueController } from './hooks/useInputValueController';\nimport { useScrollListController } from './hooks/useScrollListController';\nimport { useSelectedOptionController } from './hooks/useSelectedOptionController';\nimport type {\n  CustomSelectOptionInterface,\n  CustomSelectRenderOption,\n  MousePosition,\n  PopupDirection,\n} from './types';\nimport styles from './CustomSelect.module.css';\n\nconst sizeYClassNames = {\n  none: styles.sizeYNone,\n  compact: styles.sizeYCompact,\n};\n\nfunction defaultRenderOptionFn<T extends CustomSelectOptionInterface>({\n  option,\n  ...props\n}: CustomSelectRenderOption<T>): React.ReactNode {\n  return <CustomSelectOption {...props} />;\n}\n\nfunction isMousePositionChanged(event: React.MouseEvent, prevPosition: MousePosition) {\n  return (\n    Math.abs(prevPosition.x - event.clientX) >= 1 || Math.abs(prevPosition.y - event.clientY) >= 1\n  );\n}\n\nconst FETCH_STATUS_RESET_DELAY = 2000;\n\nconst FetchingStatus = ({\n  fetching = false,\n  options,\n  fetchingInProgressLabel = 'Список опций загружается...',\n  fetchingCompletedLabel = `Загружено опций: ${options.length}`,\n}: Pick<\n  SelectProps,\n  'fetching' | 'fetchingInProgressLabel' | 'fetchingCompletedLabel' | 'options'\n>) => {\n  const [status, setStatus] = React.useState<'fetching' | 'loaded' | 'none'>('none');\n\n  const content = getRequiredValueByKey(status, {\n    fetching: fetchingInProgressLabel,\n    loaded:\n      typeof fetchingCompletedLabel === 'function'\n        ? fetchingCompletedLabel(options.length)\n        : fetchingCompletedLabel,\n    none: '',\n  });\n\n  useIsomorphicLayoutEffect(\n    function updateStatus() {\n      if (fetching) {\n        setStatus('fetching');\n      } else {\n        if (status === 'fetching') {\n          setStatus('loaded');\n          setTimeout(() => setStatus('none'), FETCH_STATUS_RESET_DELAY);\n        }\n      }\n    },\n    [fetching],\n  );\n\n  return <VisuallyHidden aria-live=\"polite\">{content}</VisuallyHidden>;\n};\n\nexport type { CustomSelectClearButtonProps };\n\nexport interface SelectProps<\n  OptionInterfaceT extends CustomSelectOptionInterface = CustomSelectOptionInterface,\n> extends Omit<NativeSelectProps, 'slotProps'>,\n    Omit<FormFieldProps, 'maxHeight'>,\n    Pick<CustomSelectDropdownProps, 'overscrollBehavior'>,\n    Pick<CustomSelectInputProps, 'minLength' | 'maxLength' | 'pattern' | 'readOnly'> {\n  /**\n   * Свойства, которые можно прокинуть внутрь компонента:\n   * - `root`: свойства для прокидывания в корень компонента;\n   * - `select`: свойства для прокидывания в нативный `select`;\n   * - `input`: свойства для прокидывания в нативный `input`.\n   */\n  slotProps?: NativeSelectProps['slotProps'] & {\n    input?: React.InputHTMLAttributes<HTMLInputElement> &\n      HasDataAttribute &\n      HasRootRef<HTMLInputElement>;\n  };\n  /**\n   * @deprecated Since 7.9.0. Вместо этого используйте `slotProps={ input: { getRootRef: ... } }`.\n   *\n   * Ref на внутрений компонент input.\n   */\n  getSelectInputRef?: React.Ref<HTMLInputElement>;\n  /**\n   * Если `true`, то при нажатии на `CustomSelect` в нём появится текстовое поле для поиска по `options`. По умолчанию поиск\n   * производится по `option.label`.\n   */\n  searchable?: boolean;\n  /**\n   * Текст, который будет отображен, если приходит пустой `options`.\n   */\n  emptyText?: string;\n  /**\n   * Событие изменения текстового поля.\n   */\n  onInputChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  /**\n   * Список опций в списке.\n   */\n  options: OptionInterfaceT[];\n  /**\n   * Функция для кастомной фильтрации. По умолчанию поиск производится по `option.label`.\n   */\n  filterFn?: false | FilterFn<OptionInterfaceT>;\n  /**\n   * Направление раскрытия выпадающего списка.\n   */\n  popupDirection?: PopupDirection;\n  /**\n   * Рендер-проп для кастомного рендера опции.\n   * В объекте аргумента приходят [свойства опции](https://vkui.io/components/custom-select#custom-select-option-api).\n   *\n   * > ⚠️  Важно: свойство опции `disabled` должно выставляться только через проп `options`.\n   * > Запрещается выставлять `disabled` проп опциям в обход `options`, иначе `CustomSelect` не будет знать об актуальном состоянии\n   * опции.\n   */\n  renderOption?: (props: CustomSelectRenderOption<OptionInterfaceT>) => React.ReactNode;\n  /**\n   * Рендер-проп для кастомного рендера содержимого дропдауна.\n   * В `defaultDropdownContent` содержится список опций в виде скроллящегося блока.\n   */\n  renderDropdown?: ({\n    defaultDropdownContent,\n  }: {\n    defaultDropdownContent: React.ReactNode;\n  }) => React.ReactNode;\n  /**\n   * Если `true`, то в дропдауне вместо списка опций рисуется спиннер. При переданных `renderDropdown` и `fetching: true`\n   * \"победит\" `renderDropdown`.\n   */\n  fetching?: boolean;\n  /**\n   * Обработчик закрытия выпадающего списка.\n   */\n  onClose?: VoidFunction;\n  /**\n   * Обработчик открытия выпадающего списка.\n   */\n  onOpen?: VoidFunction;\n  /**\n   * Иконка раскрывающегося списка.\n   */\n  icon?: React.ReactNode;\n  /**\n   * Кастомная кнопка для очистки значения.\n   * Должна принимать обязательное свойство `onClick`.\n   */\n  ClearButton?: React.ComponentType<CustomSelectClearButtonProps>;\n  /**\n   * Если `true`, то справа будет отображаться кнопка для очистки значения.\n   */\n  allowClearButton?: boolean;\n  /**\n   * Передает атрибут `data-testid` для кнопки очистки.\n   */\n  clearButtonTestId?: string;\n  /**\n   * Отступ от выпадающего списка.\n   */\n  dropdownOffsetDistance?: number;\n  /**\n   * Ширина раскрывающегося списка зависит от контента.\n   */\n  dropdownAutoWidth?: boolean;\n  /**\n   * Использовать Portal для рендеринга выпадающего списка.\n   */\n  forceDropdownPortal?: boolean;\n  /**\n   * Тип отображения компонента.\n   */\n  selectType?: SelectType;\n  /**\n   * Отключает максимальную высоту по умолчанию.\n   */\n  noMaxHeight?: boolean;\n  /**\n   * Передает атрибут `data-testid` для элемента, внутри которого отображается текст выбранной опции `CustomSelect` или плейсхолдер.\n   */\n  labelTextTestId?: string;\n  /**\n   * @deprecated Since 7.9.0. Вместо этого используйте `slotProps={ select: { 'data-testid': ... } }`.\n   *\n   * Передает атрибут `data-testid` для нативного элемента `select`.\n   */\n  nativeSelectTestId?: string;\n  /**\n   * Обработчик события `keyDown` в поле ввода.\n   */\n  onInputKeyDown?: (e: React.KeyboardEvent, isOpen: boolean) => void;\n  /**\n   * Включает режим в котором выбранное значение `CustomSelect` читается скринридерами корректно.\n   * В данном режиме введенное в поле ввода значение не сбрасывается при потере фокуса.\n   */\n  accessible?: boolean /* TODO [>=v8] включить по умолчанию */;\n  /**\n   * Текстовая метка для индикации процесса загрузки данных для пользователей скринридерами. По умолчанию: `\"Список опций загружается...\"`.\n   */\n  fetchingInProgressLabel?: string;\n  /**\n   * Текстовая метка для индикации завершения процесса загрузки данных для пользователей скринридерами. По умолчанию: `\"Загружено опций: ${options.length}\"`.\n   */\n  fetchingCompletedLabel?: string | ((optionsCount: number) => string);\n}\n\n/**\n * @see https://vkui.io/components/custom-select\n */\nexport function CustomSelect<OptionInterfaceT extends CustomSelectOptionInterface>(\n  props: SelectProps<OptionInterfaceT>,\n): React.ReactNode {\n  const {\n    style,\n    className,\n    getRootRef,\n    before,\n    name,\n    getRef,\n    popupDirection = 'bottom',\n    onChange,\n    children,\n    'onInputChange': onInputChangeProp,\n    renderDropdown,\n    onOpen,\n    onClose,\n    fetching,\n    labelTextTestId,\n    multiline,\n    placeholder,\n    status,\n    forceDropdownPortal,\n    align,\n    selectType = 'default',\n    searchable = false,\n    'renderOption': renderOptionProp = defaultRenderOptionFn,\n    'options': options,\n    emptyText = 'Ничего не найдено',\n    filterFn = defaultFilterFn,\n    'icon': iconProp,\n    ClearButton,\n    allowClearButton = false,\n    dropdownOffsetDistance = 0,\n    dropdownAutoWidth = false,\n    noMaxHeight = false,\n    'aria-labelledby': ariaLabelledBy,\n    clearButtonTestId,\n    nativeSelectTestId,\n    defaultValue,\n    required,\n    getSelectInputRef,\n    overscrollBehavior,\n    'onInputKeyDown': onInputKeyDownProp,\n    accessible = false,\n    fetchingInProgressLabel,\n    fetchingCompletedLabel,\n    'value': selectValue,\n    'onBlur': onSelectBlur,\n    'onFocus': onSelectFocus,\n    'onClick': onSelectClick,\n\n    slotProps,\n    ...restProps\n  } = props;\n\n  if (process.env.NODE_ENV === 'development') {\n    checkOptionsValueType(options);\n    checkDeprecatedProps(props);\n  }\n\n  const { sizeY = 'none' } = useAdaptivity();\n\n  const {\n    onClick: onRootClick,\n    onMouseMove: onRootMouseMove,\n    onMouseDown: onRootMouseDown,\n    getRootRef: rootRef,\n    ...rootRest\n  } = useMergeProps(\n    {\n      style,\n      className,\n      getRootRef,\n    },\n    slotProps?.root,\n  );\n\n  const { getRootRef: getSelectRef, ...selectRest } = useMergeProps(\n    {\n      getRootRef: getRef,\n      onBlur: onSelectBlur,\n      onFocus: onSelectFocus,\n      onClick: onSelectClick,\n    },\n    slotProps?.select,\n  );\n\n  const {\n    getRootRef: getInputRef,\n    onChange: onChangeInput,\n    onFocus: onInputFocus,\n    onBlur: onInputBlur,\n    onKeyDown: onNativeInputKeyDown,\n    onClick: onNativeInputClick,\n    readOnly,\n    ...inputRest\n  } = useMergeProps(\n    {\n      getRootRef: getSelectInputRef,\n      onChange: onInputChangeProp,\n      // Приводим типы так как в CustomSelect типы в rest определены как React.SelectHTMLAttributes<HTMLSelectElement>\n      // Хотя эти свойства прокидываются в input\n      ...(restProps as React.InputHTMLAttributes<HTMLInputElement>),\n    },\n    slotProps?.input,\n  );\n\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const handleRootRef = useExternRef(containerRef, rootRef);\n  const selectElRef = useExternRef(getSelectRef);\n  const selectInputRef = useExternRef(getInputRef);\n\n  const propsValue = React.useMemo<SelectValue | undefined>(() => {\n    if (selectValue === undefined) {\n      return undefined;\n    }\n    return getOptionByValue(options, selectValue)?.value ?? null;\n  }, [options, selectValue]);\n\n  const [isControlledOutside, setIsControlledOutside] = React.useState(selectValue !== undefined);\n  const [popperPlacement, setPopperPlacement] = React.useState<Placement>(popupDirection);\n\n  const {\n    nativeSelectValue,\n    setNativeSelectValue,\n    selectedOptionValue,\n    setSelectedOptionValue,\n    onNativeSelectChange,\n  } = useSelectedOptionController({\n    value: propsValue,\n    defaultValue,\n    isControlledOutside,\n    allowClearButton,\n    onChange,\n  });\n\n  const selected = React.useMemo(\n    () => options.find((option) => option.value === selectedOptionValue),\n    [options, selectedOptionValue],\n  );\n\n  const { inputValue, onInputChange, resetInputValue, resetInputValueBySelectedOption } =\n    useInputValueController({\n      options,\n      accessible,\n      selectedValue: selectedOptionValue,\n      onInputChange: onChangeInput,\n    });\n\n  const filteredOptions = React.useMemo(\n    () => filter(options, searchable ? inputValue : '', filterFn),\n    [filterFn, inputValue, options, searchable],\n  );\n\n  const { scrollToElement, optionsWrapperRef, scrollBoxRef } = useScrollListController();\n\n  const {\n    focusedOptionValue,\n    setFocusedOptionValue,\n    resetFocusedOption,\n    focusOptionByIndex,\n    focusOption,\n    selectFocusedValue,\n  } = useFocusedOptionController({\n    selectedOptionValue,\n    filteredOptions,\n    scrollToElement,\n  });\n\n  const scrollToSelectedOption = () => {\n    scrollToElement(findSelectedIndex(filteredOptions, selectedOptionValue), true);\n  };\n\n  const { opened, open, close, toggleOpened } = useDropdownOpenedController({\n    onOpen: callMultiple(selectFocusedValue, onOpen),\n    onOpened: scrollToSelectedOption,\n    onClose,\n    onClosed: accessible ? resetInputValueBySelectedOption : resetInputValue,\n  });\n\n  React.useEffect(\n    function updateOptionsValue() {\n      const value =\n        propsValue !== undefined\n          ? propsValue\n          : remapFromNativeValueToSelectValue(nativeSelectValue);\n      setSelectedOptionValue(value);\n      setFocusedOptionValue(value);\n    },\n    [propsValue, nativeSelectValue, setFocusedOptionValue, setSelectedOptionValue],\n  );\n\n  React.useEffect(\n    function syncIsControlledState() {\n      setIsControlledOutside((oldIsControlled) => {\n        const newIsControlled = propsValue !== undefined;\n        checkMixControlledAndUncontrolledState(oldIsControlled, newIsControlled);\n        return newIsControlled;\n      });\n    },\n    [propsValue],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    if (\n      filteredOptions.some(({ value }) => nativeSelectValue === value) ||\n      (allowClearButton && nativeSelectValue === NOT_SELECTED.NATIVE)\n    ) {\n      const event = new Event('change', { bubbles: true });\n\n      selectElRef.current?.dispatchEvent(event);\n    }\n  }, [nativeSelectValue]);\n\n  const openedClassNames = React.useMemo(\n    () =>\n      (opened &&\n        dropdownOffsetDistance === 0 &&\n        (popperPlacement.includes('top') ? styles.popUp : styles.popDown)) ||\n      undefined,\n    [dropdownOffsetDistance, opened, popperPlacement],\n  );\n\n  const selectOption = React.useCallback(\n    (value: Exclude<SelectValue, null>) => {\n      setNativeSelectValue(value ?? NOT_SELECTED.NATIVE);\n      close();\n\n      const shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync =\n        isControlledOutside && propsValue !== nativeSelectValue && nativeSelectValue === value;\n\n      if (shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync) {\n        const event = new Event('change', { bubbles: true });\n        selectElRef.current?.dispatchEvent(event);\n      }\n    },\n    [close, setNativeSelectValue, isControlledOutside, propsValue, nativeSelectValue, selectElRef],\n  );\n\n  const selectFocused = React.useCallback(() => {\n    if (focusedOptionValue === null) {\n      return;\n    }\n\n    selectOption(focusedOptionValue);\n  }, [focusedOptionValue, selectOption]);\n\n  const handleInputKeyDown = useInputKeyboardController({\n    opened,\n    open,\n    close,\n    resetFocusedOption,\n    selectFocused,\n    focusOption,\n    scrollBoxRef,\n    onInputKeyDown: onInputKeyDownProp,\n  });\n\n  const onBlur = React.useCallback(() => {\n    close();\n    const event = new Event('focusout', { bubbles: true });\n    selectElRef.current?.dispatchEvent(event);\n  }, [close, selectElRef]);\n\n  const onFocus = React.useCallback(() => {\n    const event = new Event('focusin', { bubbles: true });\n    selectElRef.current?.dispatchEvent(event);\n  }, [selectElRef]);\n\n  const handleOptionClick = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      const index = Array.prototype.indexOf.call(\n        e.currentTarget.parentNode?.children,\n        e.currentTarget,\n      );\n      const option = filteredOptions[index];\n\n      if (option && !option.disabled) {\n        selectOption(option.value);\n      }\n    },\n    [filteredOptions, selectOption],\n  );\n\n  const lastMousePositionRef = React.useRef<MousePosition>({ x: 0, y: 0 });\n  const focusOptionOnMouseMove = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>, index: number) => {\n      if (isMousePositionChanged(e, lastMousePositionRef.current)) {\n        focusOptionByIndex(index, false);\n      }\n    },\n    [focusOptionByIndex],\n  );\n\n  const popupAriaId = React.useId();\n  const renderOption = React.useCallback(\n    (option: OptionInterfaceT, index: number) => {\n      const hovered = option.value === focusedOptionValue;\n      const selected = option.value === selectedOptionValue;\n\n      return (\n        <React.Fragment key={`${typeof option.value}-${option.value}`}>\n          {renderOptionProp({\n            option,\n            hovered,\n            children: option.label,\n            selected,\n            disabled: option.disabled,\n            onClick: handleOptionClick,\n            onMouseDown: preventDefault,\n            // Используем `onMouseMove` вместо `onMouseEnter/onMouseOver`.\n            // Потому что если при навигации с клавиатуры курсор наведён на\n            // список, то при первом автоматическом скролле списка вызывается событие MouseOver/MouseEnter\n            // обработчик которого фокусирует опцию под курсором, хотя при навигация с клавиатуры пользователь мог уйти дальше по списку, это путает.\n            // Причём координаты события меняются на пару пикселей по сравнению с прошлым вызовом,\n            // а значит нельзя на них опираться, чтобы запретить обработку такого события.\n            // C mousemove такой проблемы нет, что позволяет реализовать поведение при наведении с клавиатуры и при наведении мышью идентично `<select>`.\n            onMouseMove: (e) => focusOptionOnMouseMove(e, index),\n            id: `${popupAriaId}-${option.value}`,\n            ...option,\n          })}\n        </React.Fragment>\n      );\n    },\n    [\n      focusedOptionValue,\n      selectedOptionValue,\n      renderOptionProp,\n      handleOptionClick,\n      popupAriaId,\n      focusOptionOnMouseMove,\n    ],\n  );\n\n  const resolvedContent = React.useMemo(() => {\n    const defaultDropdownContent =\n      filteredOptions.length > 0 ? (\n        <div ref={optionsWrapperRef}>{filteredOptions.map(renderOption)}</div>\n      ) : (\n        <Footnote className={styles.empty}>{emptyText}</Footnote>\n      );\n\n    if (typeof renderDropdown === 'function') {\n      return renderDropdown({ defaultDropdownContent });\n    } else {\n      return defaultDropdownContent;\n    }\n  }, [emptyText, filteredOptions, optionsWrapperRef, renderDropdown, renderOption]);\n\n  const afterItems = useAfterItems({\n    value: propsValue,\n    nativeSelectValue,\n    isControlledOutside,\n    opened,\n    allowClearButton,\n    ClearButton,\n    onClearButtonClick: () => {\n      setNativeSelectValue(NOT_SELECTED.NATIVE);\n      resetInputValue();\n      selectInputRef.current && selectInputRef.current.focus();\n    },\n    clearButtonTestId,\n    disabled: restProps.disabled,\n    readOnly,\n    icon: iconProp,\n  });\n\n  const { document } = useDOM();\n  const passClickAndFocusToInputOnClick = React.useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      // Раньше внешней оберткой CustomSelect был <label>, что позволяло по клику в любую область CustomSelect,\n      // даже где нету интерактивного элемента, фокусировать <input> и передавать на него событие клика.\n      // Так как мы больше не оборачиваем CustomSelect в <label>, то для обертки CustomSelect мы симулируем работу <label>.\n      // передаем фокус и клик по <input>, если пользователь кликнул в зоне обертки.\n      // В <label> мы не больше не оборачиваем, потому что это заставляет скринридер\n      // дважды произносить текст выбранной опции при фокусе, если CustomSelect связан с внешним <label>.\n      // Воспроизводится в некоторых версиях Chrome, при навигации по странице с помощью стрелок.\n      // Договорились со специалистом по доступности убрать <label>-обёртки из Select и CustomSelect\n\n      if (!selectInputRef.current || !document) {\n        return;\n      }\n\n      const clickTargetIsNotAnInput = e.target !== selectInputRef.current;\n      if (clickTargetIsNotAnInput) {\n        selectInputRef.current.click();\n\n        const inputIsNotFocused = document.activeElement !== selectInputRef.current;\n        if (inputIsNotFocused) {\n          selectInputRef.current.focus();\n        }\n      }\n    },\n    [document, selectInputRef],\n  );\n\n  const preventInputBlurWhenClickInsideFocusedSelectArea = (\n    e: React.MouseEvent<HTMLDivElement>,\n  ) => {\n    // Так как инпут больше не оборачивается пустым лэйблом, то клик внутри обертки,\n    // но вне инпута (например по иконке дропдауна), будет убирать фокус с инпута.\n    // Чтобы в такой ситуации отключить blur инпута мы превентим mousedown событие обёртки\n    const isInputFocused = document && document.activeElement === selectInputRef.current;\n    if (isInputFocused) {\n      e.preventDefault();\n    }\n  };\n\n  const ariaActiveDescendantId = focusedOptionValue !== null ? focusedOptionValue : undefined;\n\n  const selectInputAriaProps: React.HTMLAttributes<HTMLElement> = {\n    'role': 'combobox',\n    'aria-controls': popupAriaId,\n    'aria-expanded': opened,\n    'aria-activedescendant':\n      ariaActiveDescendantId && opened ? `${popupAriaId}-${ariaActiveDescendantId}` : undefined,\n    'aria-labelledby': ariaLabelledBy,\n    'aria-haspopup': 'listbox',\n    'aria-autocomplete': 'none',\n  };\n\n  const resetOptionFocusOnMouseLeave = React.useCallback(\n    (event: React.MouseEvent) => {\n      // В Хроме eсли мышка пользователя находится над инпутом селекта,\n      // и он с клавиатуры открывает опции, причём одна из опций\n      // уже выбрана, то видно, как выбранная опция получает фокус,\n      // но потом сразу же его теряет.\n      // Связано это с тем, что в этот момент вызывается onMouseLeave, на который у нас\n      // завязан сброс состония фокуса у опции. По хорошему фокус должен оставаться.\n      // Нам не интересен вызов onMouseLeave если мышка при этом не двигалась.\n      if (isMousePositionChanged(event, lastMousePositionRef.current)) {\n        resetFocusedOption();\n      }\n    },\n    [resetFocusedOption],\n  );\n\n  const updateLastMousePosition = (e: React.MouseEvent) => {\n    lastMousePositionRef.current = { x: e.clientX, y: e.clientY };\n  };\n\n  return (\n    <RootComponent\n      baseClassName={classNames(styles.host, sizeY !== 'regular' && sizeYClassNames[sizeY])}\n      getRootRef={handleRootRef}\n      onClick={callMultiple(onRootClick, passClickAndFocusToInputOnClick)}\n      onMouseDown={callMultiple(onRootMouseDown, preventInputBlurWhenClickInsideFocusedSelectArea)}\n      onMouseMove={callMultiple(onRootMouseMove, updateLastMousePosition)}\n      {...rootRest}\n    >\n      <CustomSelectInput\n        autoComplete=\"off\"\n        autoCapitalize=\"none\"\n        autoCorrect=\"off\"\n        spellCheck=\"false\"\n        fetching={fetching}\n        searchable={searchable}\n        accessible={accessible}\n        before={before}\n        after={afterItems}\n        selectType={selectType}\n        align={align}\n        status={status}\n        placeholder={placeholder}\n        multiline={multiline}\n        labelTextTestId={labelTextTestId}\n        slotProps={{\n          root: { className: openedClassNames },\n          input: {\n            getRootRef: selectInputRef,\n            onChange: onInputChange,\n            onFocus: callMultiple(onFocus, onInputFocus),\n            onBlur: callMultiple(onBlur, onInputBlur),\n            onKeyDown: !readOnly\n              ? callMultiple(handleInputKeyDown, onNativeInputKeyDown)\n              : onNativeInputKeyDown,\n            onClick: !readOnly\n              ? callMultiple(toggleOpened, onNativeInputClick)\n              : onNativeInputClick,\n            value: inputValue,\n            readOnly: readOnly || !searchable,\n            ...selectInputAriaProps,\n            ...inputRest,\n          },\n        }}\n      >\n        {selected?.label}\n      </CustomSelectInput>\n\n      <FetchingStatus\n        fetching={fetching}\n        options={filteredOptions}\n        fetchingInProgressLabel={fetchingInProgressLabel}\n        fetchingCompletedLabel={fetchingCompletedLabel}\n      />\n      <RootComponent\n        Component=\"select\"\n        baseClassName={styles.control}\n        tabIndex={-1}\n        name={name}\n        value={nativeSelectValue}\n        aria-hidden\n        data-testid={nativeSelectTestId}\n        required={required}\n        onChange={onNativeSelectChange}\n        getRootRef={selectElRef}\n        {...selectRest}\n      >\n        {(allowClearButton || nativeSelectValue === NOT_SELECTED.NATIVE) && (\n          <option key={NOT_SELECTED.NATIVE} value={NOT_SELECTED.NATIVE} />\n        )}\n        {options.map((item) => (\n          <option key={`${item.value}`} value={item.value} />\n        ))}\n      </RootComponent>\n      {opened && (\n        <CustomSelectDropdown\n          targetRef={containerRef}\n          placement={popperPlacement}\n          scrollBoxRef={scrollBoxRef}\n          onPlacementChange={setPopperPlacement}\n          onMouseLeave={resetOptionFocusOnMouseLeave}\n          fetching={fetching}\n          overscrollBehavior={overscrollBehavior}\n          offsetDistance={dropdownOffsetDistance}\n          autoWidth={dropdownAutoWidth}\n          forcePortal={forceDropdownPortal}\n          noMaxHeight={noMaxHeight}\n          role=\"listbox\"\n          id={popupAriaId}\n          aria-labelledby={ariaLabelledBy}\n          tabIndex={-1}\n        >\n          {resolvedContent}\n        </CustomSelectDropdown>\n      )}\n    </RootComponent>\n  );\n}\n"],"names":["React","classNames","getRequiredValueByKey","useAdaptivity","useExternRef","useMergeProps","callMultiple","useDOM","defaultFilterFn","useIsomorphicLayoutEffect","preventDefault","CustomSelectDropdown","CustomSelectOption","NOT_SELECTED","remapFromNativeValueToSelectValue","RootComponent","Footnote","VisuallyHidden","CustomSelectInput","checkDeprecatedProps","checkMixControlledAndUncontrolledState","checkOptionsValueType","filter","findSelectedIndex","getOptionByValue","useAfterItems","useDropdownOpenedController","useFocusedOptionController","useInputKeyboardController","useInputValueController","useScrollListController","useSelectedOptionController","sizeYClassNames","none","compact","defaultRenderOptionFn","option","props","isMousePositionChanged","event","prevPosition","Math","abs","x","clientX","y","clientY","FETCH_STATUS_RESET_DELAY","FetchingStatus","fetching","options","fetchingInProgressLabel","fetchingCompletedLabel","length","status","setStatus","useState","content","loaded","updateStatus","setTimeout","aria-live","CustomSelect","style","className","getRootRef","before","name","getRef","popupDirection","onChange","children","onInputChangeProp","renderDropdown","onOpen","onClose","labelTextTestId","multiline","placeholder","forceDropdownPortal","align","selectType","searchable","renderOptionProp","emptyText","filterFn","iconProp","ClearButton","allowClearButton","dropdownOffsetDistance","dropdownAutoWidth","noMaxHeight","ariaLabelledBy","clearButtonTestId","nativeSelectTestId","defaultValue","required","getSelectInputRef","overscrollBehavior","onInputKeyDownProp","accessible","selectValue","onSelectBlur","onSelectFocus","onSelectClick","slotProps","restProps","process","env","NODE_ENV","sizeY","root","onClick","onRootClick","onMouseMove","onRootMouseMove","onMouseDown","onRootMouseDown","rootRef","rootRest","onBlur","onFocus","select","getSelectRef","selectRest","input","getInputRef","onChangeInput","onInputFocus","onInputBlur","onKeyDown","onNativeInputKeyDown","onNativeInputClick","readOnly","inputRest","containerRef","useRef","handleRootRef","selectElRef","selectInputRef","propsValue","useMemo","undefined","value","isControlledOutside","setIsControlledOutside","popperPlacement","setPopperPlacement","nativeSelectValue","setNativeSelectValue","selectedOptionValue","setSelectedOptionValue","onNativeSelectChange","selected","find","inputValue","onInputChange","resetInputValue","resetInputValueBySelectedOption","selectedValue","filteredOptions","scrollToElement","optionsWrapperRef","scrollBoxRef","focusedOptionValue","setFocusedOptionValue","resetFocusedOption","focusOptionByIndex","focusOption","selectFocusedValue","scrollToSelectedOption","opened","open","close","toggleOpened","onOpened","onClosed","useEffect","updateOptionsValue","syncIsControlledState","oldIsControlled","newIsControlled","some","NATIVE","Event","bubbles","current","dispatchEvent","openedClassNames","includes","selectOption","useCallback","shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync","selectFocused","handleInputKeyDown","onInputKeyDown","handleOptionClick","e","index","Array","prototype","indexOf","call","currentTarget","parentNode","disabled","lastMousePositionRef","focusOptionOnMouseMove","popupAriaId","useId","renderOption","hovered","Fragment","label","id","resolvedContent","defaultDropdownContent","div","ref","map","afterItems","onClearButtonClick","focus","icon","document","passClickAndFocusToInputOnClick","clickTargetIsNotAnInput","target","click","inputIsNotFocused","activeElement","preventInputBlurWhenClickInsideFocusedSelectArea","isInputFocused","ariaActiveDescendantId","selectInputAriaProps","resetOptionFocusOnMouseLeave","updateLastMousePosition","baseClassName","autoComplete","autoCapitalize","autoCorrect","spellCheck","after","Component","tabIndex","aria-hidden","data-testid","item","targetRef","placement","onPlacementChange","onMouseLeave","offsetDistance","autoWidth","forcePortal","role","aria-labelledby"],"mappings":"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"}