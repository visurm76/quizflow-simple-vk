{"version":3,"sources":["../../../../src/components/DateRangeInput/DateRangeInput.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { Icon16Clear, Icon20CalendarOutline } from '@vkontakte/icons';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useDateInput } from '../../hooks/useDateInput';\nimport { useCustomEnsuredControl } from '../../hooks/useEnsuredControl';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { type UseFocusTrapProps } from '../../hooks/useFocusTrap';\nimport { dateFormatter, isMatch, parse } from '../../lib/date';\nimport type { PlacementWithAuto } from '../../lib/floating';\nimport type { HasRootRef } from '../../types';\nimport {\n  CalendarRange,\n  type CalendarRangeProps,\n  type CalendarRangeTestsProps,\n  type DateRangeType,\n} from '../CalendarRange/CalendarRange';\nimport { useConfigProvider } from '../ConfigProvider/ConfigProviderContext';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { FormField, type FormFieldProps } from '../FormField/FormField';\nimport { IconButton } from '../IconButton/IconButton';\nimport { InputLikeDivider } from '../InputLike/InputLikeDivider';\nimport { NumberInputLike } from '../NumberInputLike/NumberInputLike';\nimport { Popper } from '../Popper/Popper';\nimport { Text } from '../Typography/Text/Text';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden';\nimport dateInputStyles from '../DateInput/DateInput.module.css';\n\nconst sizeYClassNames = {\n  none: dateInputStyles.sizeYNone,\n  compact: dateInputStyles.sizeYCompact,\n};\n\ntype DateTestsProps = {\n  /**\n   * Передает атрибут `data-testid` для поля ввода дня.\n   */\n  day?: string;\n  /**\n   * Передает атрибут `data-testid` для поля ввода месяца.\n   */\n  month?: string;\n  /**\n   * Передает атрибут `data-testid` для поля ввода года.\n   */\n  year?: string;\n};\n\nexport type DateRangeInputTestsProps = {\n  /**\n   * Передает атрибуты `data-testid` для полей ввода начальной даты.\n   */\n  startDateTestsProps?: DateTestsProps;\n  /**\n   * Передает атрибуты `data-testid` для полей ввода конечной даты.\n   */\n  endDateTestsProps?: DateTestsProps;\n  /**\n   * Передает атрибут `data-testid` для кнопки показа календаря.\n   */\n  showCalendarButtonTestId?: string;\n  /**\n   * Передает атрибут `data-testid` для кнопки очистки даты.\n   */\n  clearButtonTestId?: string;\n};\n\nexport interface DateRangeInputProps\n  extends Omit<React.InputHTMLAttributes<HTMLDivElement>, 'value' | 'defaultValue' | 'onChange'>,\n    Pick<\n      CalendarRangeProps,\n      | 'disablePast'\n      | 'disableFuture'\n      | 'shouldDisableDate'\n      | 'onChange'\n      | 'value'\n      | 'defaultValue'\n      | 'weekStartsOn'\n      | 'disablePickers'\n      | 'prevMonthLabel'\n      | 'nextMonthLabel'\n      | 'changeMonthLabel'\n      | 'changeYearLabel'\n      | 'changeDayLabel'\n      | 'prevMonthIcon'\n      | 'nextMonthIcon'\n      | 'renderDayContent'\n    >,\n    Pick<UseFocusTrapProps, 'restoreFocus'>,\n    HasRootRef<HTMLDivElement>,\n    Omit<FormFieldProps, 'maxHeight'>,\n    DateRangeInputTestsProps {\n  /**\n   * Передает атрибуты `data-testid` для интерактивных элементов в календаре.\n   */\n  calendarTestsProps?: CalendarRangeTestsProps;\n  /**\n   * Расположение календаря относительно поля ввода.\n   */\n  calendarPlacement?: PlacementWithAuto;\n  /**\n   * Автоматически закрывать календарь при изменениях.\n   */\n  closeOnChange?: boolean;\n  /**\n   * Обработчик изменения состояния открытия календаря.\n   */\n  onCalendarOpenChanged?: (opened: boolean) => void;\n  /**\n   * Label для календаря.\n   */\n  calendarLabel?: string;\n  /**\n   * Label для кнопки очистки. Делает доступным для ассистивных технологий.\n   */\n  clearFieldLabel?: string;\n  /**\n   * Label для кнопки открытия календаря. Делает доступным для ассистивных технологий.\n   */\n  showCalendarLabel?: string;\n  /**\n   * Label для ввода дня начальной даты. Делает доступным для ассистивных технологий.\n   */\n  changeStartDayLabel?: string;\n  /**\n   * Label для ввода месяца начальной даты. Делает доступным для ассистивных технологий.\n   */\n  changeStartMonthLabel?: string;\n  /**\n   * Label для ввода года начальной даты. Делает доступным для ассистивных технологий.\n   */\n  changeStartYearLabel?: string;\n  /**\n   * Label для ввода дня конечной даты. Делает доступным для ассистивных технологий.\n   */\n  changeEndDayLabel?: string;\n  /**\n   * Label для ввода месяца конечной даты. Делает доступным для ассистивных технологий.\n   */\n  changeEndMonthLabel?: string;\n  /**\n   * Label для ввода года конечной даты. Делает доступным для ассистивных технологий.\n   */\n  changeEndYearLabel?: string;\n  /**\n   * Отключение открытия календаря.\n   */\n  disableCalendar?: boolean;\n  /**\n   * Позволяет отключить захват фокуса при появлении календаря.\n   */\n  disableFocusTrap?: UseFocusTrapProps['disabled'];\n  /**\n   * Включает режим в котором DateRangeInput доступен\n   * для ассистивных технологий.\n   * В этом режиме:\n   * - календарь больше не открывает при фокусе на DateRangeInput;\n   * - иконка календаря видна всегда, чтобы пользователи\n   * ассистивных технологий могли открыть календарь по клику на иконку;\n   * - календарь при открытии получает фокус, клавиатурный\n   * фокус зациклен и не выходит за пределы календаря пока календарь не закрыт.\n   */\n  accessible?: boolean; // TODO [>=8]: включить по умолчанию.\n}\n\nconst elementsConfig = (index: number) => {\n  let length = 2;\n  let min = 1;\n  let max = 0;\n\n  switch (index) {\n    case 0:\n    case 3:\n      max = 31;\n      break;\n    case 1:\n    case 4:\n      max = 12;\n      break;\n    case 2:\n    case 5:\n      max = 2100;\n      min = 1900;\n      length = 4;\n      break;\n  }\n\n  return { length, min, max };\n};\n\nconst getInternalValue = (value: CalendarRangeProps['value']) => {\n  const newValue = ['', '', '', '', '', ''];\n  if (value?.[0]) {\n    newValue[0] = String(value[0].getDate()).padStart(2, '0');\n    newValue[1] = String(value[0].getMonth() + 1).padStart(2, '0');\n    newValue[2] = String(value[0].getFullYear()).padStart(4, '0');\n  }\n  if (value?.[1]) {\n    newValue[3] = String(value[1].getDate()).padStart(2, '0');\n    newValue[4] = String(value[1].getMonth() + 1).padStart(2, '0');\n    newValue[5] = String(value[1].getFullYear()).padStart(4, '0');\n  }\n  return newValue;\n};\n\nconst CALENDAR_MUTATION_OBSERVER_OPTIONS: MutationObserverInit = {\n  childList: true,\n  subtree: true,\n  attributes: true,\n  attributeFilter: ['tabindex'],\n};\n\n/**\n * @see https://vkui.io/components/date-range-input\n */\nexport const DateRangeInput = ({\n  shouldDisableDate,\n  disableFuture,\n  disablePast,\n  'value': valueProp,\n  defaultValue,\n  onChange,\n  'calendarPlacement': calendarPlacementProp = 'bottom-start',\n  style,\n  className,\n  closeOnChange = true,\n  disablePickers,\n  getRootRef,\n  name,\n  autoFocus,\n  disabled,\n  disableFocusTrap,\n  restoreFocus,\n  calendarLabel = 'Календарь',\n  prevMonthLabel = 'Предыдущий месяц',\n  nextMonthLabel = 'Следующий месяц',\n  changeMonthLabel = 'Месяц',\n  changeYearLabel = 'Год',\n  changeStartDayLabel = 'День начала',\n  changeStartMonthLabel = 'Месяц начала',\n  changeStartYearLabel = 'Год начала',\n  changeEndDayLabel = 'День окончания',\n  changeEndMonthLabel = 'Месяц окончания',\n  changeEndYearLabel = 'Год окончания',\n  clearFieldLabel = 'Очистить поле',\n  showCalendarLabel = 'Показать календарь',\n  'aria-label': ariaLabel = '',\n  prevMonthIcon,\n  nextMonthIcon,\n  onCalendarOpenChanged,\n  renderDayContent,\n  calendarTestsProps,\n  startDateTestsProps,\n  endDateTestsProps,\n  clearButtonTestId,\n  showCalendarButtonTestId,\n  id,\n  accessible,\n  readOnly,\n  'disableCalendar': disableCalendarProp = false,\n  before,\n  ...props\n}: DateRangeInputProps): React.ReactNode => {\n  const daysStartRef = React.useRef<HTMLSpanElement>(null);\n  const monthsStartRef = React.useRef<HTMLSpanElement>(null);\n  const yearsStartRef = React.useRef<HTMLSpanElement>(null);\n  const daysEndRef = React.useRef<HTMLSpanElement>(null);\n  const monthsEndRef = React.useRef<HTMLSpanElement>(null);\n  const yearsEndRef = React.useRef<HTMLSpanElement>(null);\n\n  const disableCalendar = readOnly ? true : disableCalendarProp;\n\n  const _onChange = React.useCallback(\n    (newValue: DateRangeType | null | undefined) => onChange?.(newValue || undefined),\n    [onChange],\n  );\n\n  const [value, updateValue] = useCustomEnsuredControl<DateRangeType | null | undefined>({\n    value: valueProp,\n    defaultValue,\n    onChange: _onChange,\n  });\n\n  const onInternalValueChange = React.useCallback(\n    (internalValue: string[]) => {\n      let isStartValid = true;\n      let isEndValid = true;\n      for (let i = 0; i <= 2; i += 1) {\n        if (internalValue[i].length < elementsConfig(i).length) {\n          isStartValid = false;\n        }\n      }\n      for (let i = 3; i <= 5; i += 1) {\n        if (internalValue[i].length < elementsConfig(i).length) {\n          isEndValid = false;\n        }\n      }\n      const formattedStartValue = `${internalValue[0]}.${internalValue[1]}.${internalValue[2]}`;\n      const formattedEndValue = `${internalValue[3]}.${internalValue[4]}.${internalValue[5]}`;\n      const mask = 'dd.MM.yyyy';\n\n      if (!isMatch(formattedStartValue, mask)) {\n        isStartValid = false;\n      }\n      if (!isMatch(formattedEndValue, mask)) {\n        isEndValid = false;\n      }\n\n      if (!isStartValid && !isEndValid) {\n        return;\n      }\n\n      const valueExists = Array.isArray(value);\n      const now = new Date();\n      const start = isStartValid\n        ? parse(formattedStartValue, mask, (valueExists && value?.[0]) || now)\n        : null;\n      const end = isEndValid\n        ? parse(formattedEndValue, mask, (valueExists && value?.[1]) || now)\n        : null;\n      if (start && end && end > start) {\n        updateValue([start, end]);\n      }\n    },\n    [updateValue, value],\n  );\n\n  const refs = React.useMemo(\n    () => [daysStartRef, monthsStartRef, yearsStartRef, daysEndRef, monthsEndRef, yearsEndRef],\n    [daysStartRef, monthsStartRef, yearsStartRef, daysEndRef, monthsEndRef, yearsEndRef],\n  );\n\n  const onClear = React.useCallback(() => updateValue(undefined), [updateValue]);\n\n  const {\n    rootRef,\n    calendarRef,\n    open,\n    openCalendar,\n    closeCalendar,\n    toggleCalendar,\n    internalValue,\n    handleKeyDown,\n    setFocusedElement,\n    handleFieldEnter,\n    clear,\n    removeFocusFromField,\n  } = useDateInput({\n    maxElement: 5,\n    refs,\n    autoFocus,\n    disabled: disabled || readOnly,\n    elementsConfig,\n    onClear,\n    onInternalValueChange,\n    getInternalValue,\n    value,\n    onCalendarOpenChanged,\n    accessible,\n  });\n\n  const { sizeY = 'none' } = useAdaptivity();\n\n  const handleRootRef = useExternRef(rootRef, getRootRef);\n\n  const onCalendarChange = React.useCallback(\n    (newValue: DateRangeType | undefined) => {\n      updateValue(newValue);\n      if (closeOnChange && newValue?.[1] && newValue[1] !== value?.[1]) {\n        removeFocusFromField();\n      }\n    },\n    [updateValue, closeOnChange, value, removeFocusFromField],\n  );\n\n  // при переключении месяцев высота календаря может меняться,\n  // чтобы календарь не прыгал при переключении месяцев каждый раз на\n  // лучшую позицию мы запоминаем последнюю удачную, чтобы календарь оставался\n  // на ней, пока помещается.\n  const [calendarPlacement, setCalendarPlacement] =\n    React.useState<PlacementWithAuto>(calendarPlacementProp);\n\n  const { locale } = useConfigProvider();\n  const currentDateLabel = React.useMemo(() => {\n    if (!value) {\n      return null;\n    }\n    const [startDate, endDate] = value;\n    if (!startDate || !endDate) {\n      return null;\n    }\n    return [\n      new Intl.DateTimeFormat(locale, {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n      }).format(startDate),\n      new Intl.DateTimeFormat(locale, {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n      }).format(endDate),\n    ].join(' - ');\n  }, [locale, value]);\n\n  const currentDateLabelId = React.useId();\n  const ariaLabelId = React.useId();\n\n  const showCalendarOnInputAreaClick = React.useCallback(() => {\n    handleFieldEnter();\n    if (accessible) {\n      openCalendar();\n    }\n  }, [handleFieldEnter, openCalendar, accessible]);\n\n  const showCalendarButton = !disableCalendar && (accessible || (!accessible && !value));\n  const showClearButton = value && !readOnly;\n\n  return (\n    <FormField\n      style={style}\n      className={classNames(\n        sizeY !== 'regular' && sizeYClassNames[sizeY],\n        !!before && dateInputStyles.hasBefore,\n        (showCalendarButton || showClearButton) && dateInputStyles.hasAfter,\n        className,\n      )}\n      getRootRef={handleRootRef}\n      role=\"group\"\n      aria-labelledby={`${ariaLabelId} ${currentDateLabelId}`}\n      before={before}\n      after={\n        <>\n          {showCalendarButton ? (\n            <IconButton\n              hoverMode=\"opacity\"\n              label={showCalendarLabel}\n              onClick={toggleCalendar}\n              data-testid={showCalendarButtonTestId}\n            >\n              <Icon20CalendarOutline />\n            </IconButton>\n          ) : null}\n          {showClearButton ? (\n            <IconButton\n              hoverMode=\"opacity\"\n              label={clearFieldLabel}\n              onClick={clear}\n              data-testid={clearButtonTestId}\n            >\n              <Icon16Clear />\n            </IconButton>\n          ) : null}\n        </>\n      }\n      disabled={disabled}\n      {...props}\n    >\n      <div className={dateInputStyles.wrapper}>\n        {ariaLabel && <VisuallyHidden id={ariaLabelId}>{ariaLabel}</VisuallyHidden>}\n        {currentDateLabel && (\n          <VisuallyHidden id={currentDateLabelId}>{currentDateLabel}</VisuallyHidden>\n        )}\n        <VisuallyHidden\n          id={id}\n          Component=\"input\"\n          readOnly\n          aria-hidden\n          name={name}\n          tabIndex={readOnly ? 0 : -1}\n          value={\n            value\n              ? `${value[0] ? dateFormatter.format(value[0]) : ''} - ${\n                  value[1] ? dateFormatter.format(value[1]) : ''\n                }`\n              : ''\n          }\n          onFocus={handleFieldEnter}\n        />\n        <Text\n          className={dateInputStyles.input}\n          onClick={showCalendarOnInputAreaClick}\n          normalize={false}\n        >\n          <NumberInputLike\n            value={internalValue[0]}\n            minValue={1}\n            maxValue={31}\n            onKeyDown={readOnly ? undefined : handleKeyDown}\n            length={2}\n            getRootRef={daysStartRef}\n            index={0}\n            readOnly={readOnly}\n            onElementSelect={setFocusedElement}\n            label={changeStartDayLabel}\n            data-testid={startDateTestsProps?.day}\n          />\n          <InputLikeDivider>.</InputLikeDivider>\n          <NumberInputLike\n            value={internalValue[1]}\n            minValue={1}\n            maxValue={12}\n            onKeyDown={handleKeyDown}\n            length={2}\n            getRootRef={monthsStartRef}\n            index={1}\n            onElementSelect={setFocusedElement}\n            readOnly={readOnly}\n            label={changeStartMonthLabel}\n            data-testid={startDateTestsProps?.month}\n          />\n          <InputLikeDivider>.</InputLikeDivider>\n          <NumberInputLike\n            value={internalValue[2]}\n            minValue={1}\n            maxValue={275750}\n            onKeyDown={handleKeyDown}\n            length={4}\n            getRootRef={yearsStartRef}\n            index={2}\n            onElementSelect={setFocusedElement}\n            readOnly={readOnly}\n            label={changeStartYearLabel}\n            data-testid={startDateTestsProps?.year}\n          />\n          <InputLikeDivider>{' — '}</InputLikeDivider>\n          <NumberInputLike\n            value={internalValue[3]}\n            minValue={1}\n            maxValue={31}\n            onKeyDown={handleKeyDown}\n            length={2}\n            getRootRef={daysEndRef}\n            index={3}\n            onElementSelect={setFocusedElement}\n            readOnly={readOnly}\n            label={changeEndDayLabel}\n            data-testid={endDateTestsProps?.day}\n          />\n          <InputLikeDivider>.</InputLikeDivider>\n          <NumberInputLike\n            value={internalValue[4]}\n            minValue={1}\n            maxValue={12}\n            onKeyDown={handleKeyDown}\n            length={2}\n            getRootRef={monthsEndRef}\n            index={4}\n            onElementSelect={setFocusedElement}\n            readOnly={readOnly}\n            label={changeEndMonthLabel}\n            data-testid={endDateTestsProps?.month}\n          />\n          <InputLikeDivider>.</InputLikeDivider>\n          <NumberInputLike\n            value={internalValue[5]}\n            minValue={1}\n            maxValue={275750}\n            onKeyDown={handleKeyDown}\n            length={4}\n            getRootRef={yearsEndRef}\n            index={5}\n            onElementSelect={setFocusedElement}\n            readOnly={readOnly}\n            label={changeEndYearLabel}\n            data-testid={endDateTestsProps?.year}\n          />\n        </Text>\n      </div>\n      {open && !disableCalendar && (\n        <Popper\n          targetRef={rootRef}\n          offsetByMainAxis={8}\n          placement={calendarPlacement}\n          onPlacementChange={setCalendarPlacement}\n        >\n          <FocusTrap\n            onClose={closeCalendar}\n            disabled={disableFocusTrap ?? !accessible}\n            restoreFocus={restoreFocus ?? Boolean(accessible)}\n            captureEscapeKeyboardEvent={false}\n            mutationObserverOptions={CALENDAR_MUTATION_OBSERVER_OPTIONS}\n          >\n            <CalendarRange\n              value={value}\n              role=\"dialog\"\n              onChange={onCalendarChange}\n              aria-label={calendarLabel}\n              disablePast={disablePast}\n              disableFuture={disableFuture}\n              shouldDisableDate={shouldDisableDate}\n              getRootRef={calendarRef}\n              disablePickers={disablePickers}\n              prevMonthLabel={prevMonthLabel}\n              nextMonthLabel={nextMonthLabel}\n              changeMonthLabel={changeMonthLabel}\n              changeYearLabel={changeYearLabel}\n              prevMonthIcon={prevMonthIcon}\n              nextMonthIcon={nextMonthIcon}\n              renderDayContent={renderDayContent}\n              {...calendarTestsProps}\n            />\n          </FocusTrap>\n        </Popper>\n      )}\n    </FormField>\n  );\n};\n"],"names":["React","Icon16Clear","Icon20CalendarOutline","classNames","useAdaptivity","useDateInput","useCustomEnsuredControl","useExternRef","dateFormatter","isMatch","parse","CalendarRange","useConfigProvider","FocusTrap","FormField","IconButton","InputLikeDivider","NumberInputLike","Popper","Text","VisuallyHidden","dateInputStyles","sizeYClassNames","none","sizeYNone","compact","sizeYCompact","elementsConfig","index","length","min","max","getInternalValue","value","newValue","String","getDate","padStart","getMonth","getFullYear","CALENDAR_MUTATION_OBSERVER_OPTIONS","childList","subtree","attributes","attributeFilter","DateRangeInput","shouldDisableDate","disableFuture","disablePast","valueProp","defaultValue","onChange","calendarPlacementProp","style","className","closeOnChange","disablePickers","getRootRef","name","autoFocus","disabled","disableFocusTrap","restoreFocus","calendarLabel","prevMonthLabel","nextMonthLabel","changeMonthLabel","changeYearLabel","changeStartDayLabel","changeStartMonthLabel","changeStartYearLabel","changeEndDayLabel","changeEndMonthLabel","changeEndYearLabel","clearFieldLabel","showCalendarLabel","ariaLabel","prevMonthIcon","nextMonthIcon","onCalendarOpenChanged","renderDayContent","calendarTestsProps","startDateTestsProps","endDateTestsProps","clearButtonTestId","showCalendarButtonTestId","id","accessible","readOnly","disableCalendarProp","before","props","daysStartRef","useRef","monthsStartRef","yearsStartRef","daysEndRef","monthsEndRef","yearsEndRef","disableCalendar","_onChange","useCallback","undefined","updateValue","onInternalValueChange","internalValue","isStartValid","isEndValid","i","formattedStartValue","formattedEndValue","mask","valueExists","Array","isArray","now","Date","start","end","refs","useMemo","onClear","rootRef","calendarRef","open","openCalendar","closeCalendar","toggleCalendar","handleKeyDown","setFocusedElement","handleFieldEnter","clear","removeFocusFromField","maxElement","sizeY","handleRootRef","onCalendarChange","calendarPlacement","setCalendarPlacement","useState","locale","currentDateLabel","startDate","endDate","Intl","DateTimeFormat","weekday","year","month","day","format","join","currentDateLabelId","useId","ariaLabelId","showCalendarOnInputAreaClick","showCalendarButton","showClearButton","hasBefore","hasAfter","role","aria-labelledby","after","hoverMode","label","onClick","data-testid","div","wrapper","Component","aria-hidden","tabIndex","onFocus","input","normalize","minValue","maxValue","onKeyDown","onElementSelect","targetRef","offsetByMainAxis","placement","onPlacementChange","onClose","Boolean","captureEscapeKeyboardEvent","mutationObserverOptions","aria-label"],"mappings":"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"}