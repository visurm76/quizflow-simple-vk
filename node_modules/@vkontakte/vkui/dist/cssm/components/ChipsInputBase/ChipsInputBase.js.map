{"version":3,"sources":["../../../../src/components/ChipsInputBase/ChipsInputBase.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { isHTMLElement } from '@vkontakte/vkui-floating-ui/utils/dom';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useMergeProps } from '../../hooks/useMergeProps';\nimport { getHorizontalFocusGoTo, Keys } from '../../lib/accessibility';\nimport { callMultiple } from '../../lib/callMultiple';\nimport {\n  contains as checkTargetIsInputEl,\n  contains,\n  getActiveElementByAnotherElement,\n} from '../../lib/dom';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { FormField } from '../FormField/FormField';\nimport { FormFieldClearButton } from '../FormFieldClearButton/FormFieldClearButton';\nimport { Text } from '../Typography/Text/Text';\nimport { DEFAULT_INPUT_VALUE, DEFAULT_VALUE, renderChipDefault } from './constants';\nimport {\n  getChipOptionIndexByHTMLElement,\n  getChipOptionIndexByValueProp,\n  getChipOptionValueByHTMLElement,\n  getNextChipOptionIndexByNavigateToProp,\n  isInputValueEmpty,\n} from './helpers';\nimport type { ChipOption, ChipOptionValue, ChipsInputBasePrivateProps, NavigateTo } from './types';\nimport styles from './ChipsInputBase.module.css';\n\nconst warn = warnOnce('ChipsInputBase');\n\nconst sizeYClassNames = {\n  none: styles.sizeYNone,\n  compact: styles.sizeYCompact,\n} as const;\n\nexport const ChipsInputBase = <O extends ChipOption>({\n  // FormFieldProps\n  'getRootRef': rootGetRootRef,\n  'style': rootStyle,\n  'className': rootClassName,\n  before,\n  after,\n  status,\n  mode,\n  maxHeight,\n\n  // option\n  value = DEFAULT_VALUE,\n  onAddChipOption,\n  'onRemoveChipOption': onRemoveChipOptionProp,\n  renderChip = renderChipDefault,\n\n  // input\n  getRef,\n  'inputValue': inputValueProp = DEFAULT_INPUT_VALUE,\n  addOnBlur,\n  onInputChange,\n\n  // clear\n  ClearButton = FormFieldClearButton,\n  clearButtonShown,\n  clearButtonTestId,\n  onClear,\n\n  // a11y\n  chipsListLabel = 'Выбранные элементы',\n  'aria-label': ariaLabel = '',\n\n  slotProps,\n  ...restProps\n}: ChipsInputBasePrivateProps<O>): React.ReactNode => {\n  const { sizeY = 'none' } = useAdaptivity();\n\n  /* istanbul ignore if: не проверяем в тестах */\n  if (process.env.NODE_ENV === 'development' && getRef) {\n    warn('Свойство `getRef` устаревшее, используйте `slotProps={ input: { getRootRef: ... } }`');\n  }\n\n  const {\n    className,\n    style,\n    getRootRef,\n    onClick: onRootClick,\n    onMouseDown: onRootMouseDown,\n    ...rootRest\n  } = useMergeProps(\n    {\n      getRootRef: rootGetRootRef,\n      style: rootStyle,\n      className: rootClassName,\n    },\n    slotProps?.root,\n  );\n\n  const {\n    getRootRef: getInputRef,\n    onBlur,\n    placeholder,\n    readOnly,\n    disabled,\n    id,\n    value: inputValue = DEFAULT_INPUT_VALUE,\n    ...inputRest\n  } = useMergeProps(\n    {\n      getRootRef: getRef,\n      className: styles.el,\n      value: inputValueProp,\n      onChange: onInputChange,\n      ...restProps,\n    },\n    slotProps?.input,\n  );\n\n  const idGenerated = React.useId();\n  const inputRef = useExternRef(getInputRef);\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const listboxRef = React.useRef<HTMLDivElement>(null);\n\n  const valueLength = value.length;\n  const withPlaceholder = valueLength === 0;\n  const [lastFocusedChipOptionIndex, setLastFocusedChipOptionIndex] = React.useState(0);\n\n  const resetChipOptionFocusToInputEl = (inputEl: HTMLInputElement) => {\n    setLastFocusedChipOptionIndex(0);\n    inputEl.focus();\n  };\n\n  const moveFocusToChipOption = (\n    currentIndex: number,\n    navigateTo: NavigateTo,\n    listboxEl: HTMLElement,\n  ) => {\n    const index = getNextChipOptionIndexByNavigateToProp(currentIndex, navigateTo, valueLength);\n    // eslint-disable-next-line no-restricted-properties\n    const foundEl = listboxEl.querySelector<HTMLElement>(`[data-index=\"${index}\"]`);\n\n    if (foundEl) {\n      setLastFocusedChipOptionIndex(index);\n      foundEl.focus();\n    }\n  };\n\n  const removeChipOption = (o: O | ChipOptionValue, index: number) => {\n    /* istanbul ignore if: невозможный кейс (в SSR вызова этой функции не будет) */\n    if (!inputRef.current || !listboxRef.current) {\n      return;\n    }\n\n    if (valueLength > 1) {\n      if (index === valueLength - 1) {\n        moveFocusToChipOption(index, 'prev', listboxRef.current);\n      } else {\n        moveFocusToChipOption(index, 'next', listboxRef.current);\n      }\n    } else {\n      resetChipOptionFocusToInputEl(inputRef.current);\n    }\n\n    onRemoveChipOptionProp(o);\n  };\n\n  const handleListboxKeyDown = (event: React.KeyboardEvent<HTMLDivElement>) => {\n    const targetEl = event.target;\n    /* istanbul ignore if: невозможный кейс (в SSR вызова этой функции не будет) */\n    if (event.defaultPrevented || !listboxRef.current || !isHTMLElement(targetEl)) {\n      return;\n    }\n\n    switch (event.key) {\n      case Keys.ENTER: {\n        if (\n          !readOnly &&\n          checkTargetIsInputEl(targetEl, inputRef.current) &&\n          inputRef.current &&\n          !isInputValueEmpty(inputRef.current)\n        ) {\n          event.preventDefault();\n          onAddChipOption(inputRef.current.value);\n        }\n        break;\n      }\n      case Keys.DELETE:\n      case Keys.BACKSPACE: {\n        if (!readOnly && valueLength > 0) {\n          if (!checkTargetIsInputEl(targetEl, inputRef.current)) {\n            event.preventDefault();\n            removeChipOption(\n              getChipOptionValueByHTMLElement(targetEl),\n              getChipOptionIndexByHTMLElement(targetEl),\n            );\n          } else if (event.key === Keys.BACKSPACE && isInputValueEmpty(inputRef.current)) {\n            event.preventDefault();\n            moveFocusToChipOption(\n              getChipOptionIndexByHTMLElement(targetEl),\n              'last',\n              listboxRef.current,\n            );\n          }\n        }\n        break;\n      }\n      case Keys.HOME:\n      case Keys.END:\n      case Keys.ARROW_UP:\n      case Keys.ARROW_LEFT:\n      case Keys.ARROW_DOWN:\n      case Keys.ARROW_RIGHT: {\n        if (valueLength !== 0 && !checkTargetIsInputEl(targetEl, inputRef.current)) {\n          event.preventDefault();\n          moveFocusToChipOption(\n            getChipOptionIndexByHTMLElement(targetEl),\n            getHorizontalFocusGoTo(event.key),\n            listboxRef.current,\n          );\n        }\n        break;\n      }\n    }\n  };\n\n  const handleInputBlur = (event: React.FocusEvent<HTMLInputElement>) => {\n    if (onBlur) {\n      onBlur(event);\n    }\n\n    if (addOnBlur && !event.defaultPrevented && inputRef.current) {\n      onAddChipOption(inputRef.current.value);\n    }\n  };\n\n  const handleChipRemove = (event: React.MouseEvent, v: ChipOptionValue) => {\n    event.preventDefault();\n    event.stopPropagation();\n    removeChipOption(v, getChipOptionIndexByValueProp(v, value));\n  };\n\n  const handleRootClick = (event: React.MouseEvent<HTMLDivElement>) => {\n    const activeElement = getActiveElementByAnotherElement(event.currentTarget);\n    if (event.defaultPrevented || contains(event.currentTarget, activeElement)) {\n      return;\n    }\n\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  const handleClear = React.useCallback(() => {\n    if (inputRef.current) {\n      resetChipOptionFocusToInputEl(inputRef.current);\n    }\n    onClear();\n  }, [inputRef, onClear]);\n\n  const clearButton = React.useMemo(() => {\n    if (clearButtonShown) {\n      return (\n        <ClearButton onClick={handleClear} disabled={disabled} data-testid={clearButtonTestId} />\n      );\n    }\n    return undefined;\n  }, [ClearButton, clearButtonShown, clearButtonTestId, disabled, handleClear]);\n\n  const afterItems = React.useMemo(() => {\n    if (clearButton || after) {\n      return (\n        <>\n          {clearButton}\n          {after}\n        </>\n      );\n    }\n    return undefined;\n  }, [after, clearButton]);\n\n  const inputId = id || `chips-input-base-generated-id-${idGenerated}`;\n\n  const handleRootMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n    // Если клик был в один из чипов, то preventDefault делать не нужно, так как не будет срабатывать выделение текста\n    if (\n      isHTMLElement(e.target) &&\n      contains(listboxRef.current, e.target) &&\n      listboxRef.current !== e.target\n    ) {\n      return;\n    }\n    const activeElement = getActiveElementByAnotherElement(e.currentTarget);\n    // Когда выделен текст чипа не нужно делать preventDefault, чтобы сбросить выделение\n    if (contains(listboxRef.current, activeElement)) {\n      return;\n    }\n    // Когда клик в сам инпут, не нужно делать preventDefault, так как не будет работать выделение текста\n    if (e.target === inputRef.current) {\n      return;\n    }\n    // Делаем preventDefault, чтобы при клике в поле, вне инпута, высота поля не скакала от того,\n    // что фокус сначала пропадает из инпута, а потом возвращается\n    e.preventDefault();\n  };\n\n  return (\n    <FormField\n      Component=\"div\"\n      getRootRef={getRootRef}\n      // role=\"group\" добавлена, чтобы этот блок можно было найти с помощью стрелочек при использовании NVDA\n      // Если убрать, то aria-label не будет читаться\n      role=\"group\"\n      aria-label={ariaLabel}\n      style={style}\n      disabled={disabled}\n      before={before}\n      after={afterItems}\n      status={status}\n      mode={mode}\n      className={className}\n      maxHeight={maxHeight}\n      onClick={disabled ? onRootClick : callMultiple(handleRootClick, onRootClick)}\n      onMouseDown={callMultiple(handleRootMouseDown, onRootMouseDown)}\n      {...rootRest}\n    >\n      <div\n        className={classNames(\n          styles.host,\n          sizeY !== 'regular' && sizeYClassNames[sizeY],\n          withPlaceholder && styles.hasPlaceholder,\n          inputValue && styles.hasInputValue,\n        )}\n        ref={containerRef}\n        onKeyDown={disabled ? undefined : handleListboxKeyDown}\n      >\n        <div\n          className={styles.listBox}\n          // для a11y\n          ref={listboxRef}\n          role=\"listbox\"\n          aria-orientation=\"horizontal\"\n          aria-disabled={disabled}\n          aria-readonly={readOnly}\n          aria-label={chipsListLabel}\n        >\n          {value.map((option, index) => (\n            <React.Fragment key={`${typeof option.value}-${option.value}`}>\n              {renderChip(\n                {\n                  'Component': 'div',\n                  'value': option.value,\n                  'label': option.label,\n                  'disabled': option.disabled || disabled,\n                  'readOnly': option.readOnly || readOnly,\n                  'className': styles.chip,\n                  'onRemove': handleChipRemove,\n                  // чтобы можно было легче найти этот чип в DOM\n                  'data-index': index,\n                  'data-value': option.value,\n                  'data-value-type': typeof option.value,\n                  // для a11y\n                  'tabIndex': lastFocusedChipOptionIndex === index ? 0 : -1,\n                  'role': 'option',\n                  'aria-selected': true,\n                  'aria-posinset': index + 1,\n                  'aria-setsize': valueLength,\n                  'aria-description': 'Для удаления используйте Backspace или Delete',\n                },\n                option,\n              )}\n            </React.Fragment>\n          ))}\n        </div>\n        <Text\n          autoCapitalize=\"none\"\n          autoComplete=\"off\"\n          autoCorrect=\"off\"\n          spellCheck={false}\n          aria-label={ariaLabel}\n          Component=\"input\"\n          type=\"text\"\n          id={inputId}\n          getRootRef={inputRef}\n          disabled={disabled}\n          readOnly={readOnly}\n          value={inputValue}\n          placeholder={withPlaceholder ? placeholder : undefined}\n          onBlur={handleInputBlur}\n          {...inputRest}\n        />\n      </div>\n    </FormField>\n  );\n};\n"],"names":["React","classNames","isHTMLElement","useAdaptivity","useExternRef","useMergeProps","getHorizontalFocusGoTo","Keys","callMultiple","contains","checkTargetIsInputEl","getActiveElementByAnotherElement","warnOnce","FormField","FormFieldClearButton","Text","DEFAULT_INPUT_VALUE","DEFAULT_VALUE","renderChipDefault","getChipOptionIndexByHTMLElement","getChipOptionIndexByValueProp","getChipOptionValueByHTMLElement","getNextChipOptionIndexByNavigateToProp","isInputValueEmpty","styles","warn","sizeYClassNames","none","sizeYNone","compact","sizeYCompact","ChipsInputBase","rootGetRootRef","rootStyle","rootClassName","before","after","status","mode","maxHeight","value","onAddChipOption","onRemoveChipOptionProp","renderChip","getRef","inputValueProp","addOnBlur","onInputChange","ClearButton","clearButtonShown","clearButtonTestId","onClear","chipsListLabel","ariaLabel","slotProps","restProps","sizeY","process","env","NODE_ENV","className","style","getRootRef","onClick","onRootClick","onMouseDown","onRootMouseDown","rootRest","root","getInputRef","onBlur","placeholder","readOnly","disabled","id","inputValue","inputRest","el","onChange","input","idGenerated","useId","inputRef","containerRef","useRef","listboxRef","valueLength","length","withPlaceholder","lastFocusedChipOptionIndex","setLastFocusedChipOptionIndex","useState","resetChipOptionFocusToInputEl","inputEl","focus","moveFocusToChipOption","currentIndex","navigateTo","listboxEl","index","foundEl","querySelector","removeChipOption","o","current","handleListboxKeyDown","event","targetEl","target","defaultPrevented","key","ENTER","preventDefault","DELETE","BACKSPACE","HOME","END","ARROW_UP","ARROW_LEFT","ARROW_DOWN","ARROW_RIGHT","handleInputBlur","handleChipRemove","v","stopPropagation","handleRootClick","activeElement","currentTarget","handleClear","useCallback","clearButton","useMemo","data-testid","undefined","afterItems","inputId","handleRootMouseDown","e","Component","role","aria-label","div","host","hasPlaceholder","hasInputValue","ref","onKeyDown","listBox","aria-orientation","aria-disabled","aria-readonly","map","option","Fragment","label","chip","autoCapitalize","autoComplete","autoCorrect","spellCheck","type"],"mappings":"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"}