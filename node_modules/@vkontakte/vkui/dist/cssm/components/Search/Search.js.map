{"version":3,"sources":["../../../../src/components/Search/Search.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { Icon16Clear, Icon16SearchOutline, Icon24Cancel } from '@vkontakte/icons';\nimport { classNames, hasReactNode, noop } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useAdaptivityConditionalRender } from '../../hooks/useAdaptivityConditionalRender';\nimport { useBooleanState } from '../../hooks/useBooleanState';\nimport { useConfigDirection } from '../../hooks/useConfigDirection';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useMergeProps } from '../../hooks/useMergeProps';\nimport { useNativeFormResetListener } from '../../hooks/useNativeFormResetListener';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { callMultiple } from '../../lib/callMultiple';\nimport { touchEnabled } from '../../lib/touch';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../lib/warnOnce';\nimport type { HasDataAttribute, HasRootRef } from '../../types';\nimport { Button } from '../Button/Button';\nimport { IconButton, type IconButtonProps } from '../IconButton/IconButton';\nimport { RootComponent } from '../RootComponent/RootComponent';\nimport { Headline } from '../Typography/Headline/Headline';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden';\nimport styles from './Search.module.css';\n\nconst warn = warnOnce('Search');\n\nexport type RenderIconButtonFn = (\n  icon: React.ReactNode,\n  props?: Partial<IconButtonProps> & HasDataAttribute,\n) => React.ReactElement;\n\nexport interface SearchProps\n  extends React.InputHTMLAttributes<HTMLInputElement>,\n    HasRootRef<HTMLDivElement> {\n  /**\n   * @deprecated Since 7.9.0. Вместо этого используйте `slotProps={ input: { getRootRef: ... } }`.\n   */\n  getRef?: React.Ref<HTMLInputElement>;\n  /**\n   * Свойства, которые можно прокинуть внутрь компонента:\n   * - `root`: свойства для прокидывания в корень компонента;\n   * - `input`: свойства для прокидывания в поле ввода.\n   */\n  slotProps?: {\n    root?: React.HTMLAttributes<HTMLDivElement> & HasRootRef<HTMLDivElement> & HasDataAttribute;\n    input?: React.InputHTMLAttributes<HTMLInputElement> &\n      HasRootRef<HTMLInputElement> &\n      HasDataAttribute;\n  };\n  /**\n   * Only iOS. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: React.ReactNode;\n  /**\n   * Контент, отображаемый перед полем ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Иконка поиска. Может быть React-элементом или функцией, возвращающей элемент.\n   */\n  icon?: React.ReactNode | ((renderFn: RenderIconButtonFn) => React.ReactNode);\n  /**\n   * Обработчик нажатия на иконку поиска.\n   */\n  onIconClick?: React.PointerEventHandler<HTMLElement>;\n  /**\n   * Значение поля ввода по умолчанию.\n   */\n  defaultValue?: string;\n  /**\n   * Текст для скринридеров, описывающий иконку поиска.\n   */\n  iconLabel?: string;\n  /**\n   * Текст для скринридеров, описывающий кнопку очистки.\n   */\n  clearLabel?: string;\n  /**\n   * Передает атрибут `data-testid` для кнопки очистки.\n   */\n  clearButtonTestId?: string;\n  /**\n   * Удаляет отступы у компонента.\n   */\n  noPadding?: boolean;\n  /**\n   * Текст для кнопки Найти.\n   */\n  findButtonText?: string;\n  /**\n   * Обработчик, при нажатии на кнопку \"Найти\".\n   */\n  onFindButtonClick?: React.MouseEventHandler<HTMLElement>;\n  /**\n   * Передает атрибут `data-testid` для кнопки поиска.\n   */\n  findButtonTestId?: string;\n  /**\n   * Скрывает кнопку очистки.\n   */\n  hideClearButton?: boolean;\n}\n\n/**\n * @see https://vkui.io/components/search\n */\nexport const Search = ({\n  className,\n  getRootRef,\n  style,\n  placeholder: placeholderProp = 'Поиск',\n  before = <Icon16SearchOutline />,\n  after = 'Отмена',\n  getRef,\n  icon: iconProp,\n  onIconClick,\n  autoComplete: autoCompleteProp = 'off',\n  iconLabel,\n  clearLabel = 'Очистить',\n  clearButtonTestId,\n  noPadding,\n  findButtonText = 'Найти',\n  findButtonTestId,\n  onFindButtonClick,\n  hideClearButton,\n\n  slotProps,\n  ...inputProps\n}: SearchProps): React.ReactNode => {\n  /* istanbul ignore if: не проверяем в тестах */\n  if (process.env.NODE_ENV === 'development' && getRef) {\n    warn('Свойство `getRef` устаревшее, используйте `slotProps={ input: { getRootRef: ... } }`');\n  }\n\n  const direction = useConfigDirection();\n  const isRtl = direction === 'rtl';\n\n  const rootRest = useMergeProps(\n    {\n      className,\n      style,\n      getRootRef,\n    },\n    slotProps?.root,\n  );\n\n  const {\n    id,\n    placeholder,\n    onChange,\n    autoComplete,\n    getRootRef: getInputRef,\n    onFocus: onInputFocus,\n    onBlur: onInputBlur,\n    ...inputRest\n  } = useMergeProps(\n    {\n      getRootRef: getRef,\n      placeholder: placeholderProp,\n      autoComplete: autoCompleteProp,\n      className: styles.nativeInput,\n      ...inputProps,\n    },\n    slotProps?.input,\n  );\n\n  const inputRef = useExternRef(getInputRef);\n  const {\n    value: isFocused,\n    setTrue: setFocusedTrue,\n    setFalse: setFocusedFalse,\n  } = useBooleanState(false);\n  const generatedId = React.useId();\n  const inputId = id ? id : `search-${generatedId}`;\n\n  const [hasValue, setHasValue] = React.useState<boolean>(() =>\n    Boolean(inputRest.value || inputRest.defaultValue),\n  );\n  const checkHasValue: React.ChangeEventHandler<HTMLInputElement> = (e) =>\n    setHasValue(Boolean(e.currentTarget.value));\n\n  const { sizeY = 'none' } = useAdaptivity();\n  const { sizeY: adaptiveSizeY } = useAdaptivityConditionalRender();\n  const platform = usePlatform();\n\n  const hasAfter = platform === 'ios' && hasReactNode(after);\n\n  const onFocus = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocusedTrue();\n    onInputFocus && onInputFocus(e);\n  };\n\n  const onBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocusedFalse();\n    onInputBlur && onInputBlur(e);\n  };\n\n  const onCancel = React.useCallback(() => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(\n      HTMLInputElement.prototype,\n      'value',\n    )?.set;\n    nativeInputValueSetter?.call(inputRef.current, '');\n\n    const ev2 = new Event('input', { bubbles: true });\n    inputRef.current?.dispatchEvent(ev2);\n  }, [inputRef]);\n\n  const onIconClickStart: React.PointerEventHandler<HTMLElement> = React.useCallback(\n    (e) => onIconClick?.(e),\n    [onIconClick],\n  );\n\n  const onIconCancelClickStart: React.PointerEventHandler<HTMLElement> = React.useCallback(\n    (e) => {\n      e.preventDefault();\n      inputRef.current?.focus();\n      if (touchEnabled()) {\n        onCancel();\n      }\n    },\n    [inputRef, onCancel],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    if (inputRest.value !== undefined) {\n      setHasValue(Boolean(inputRest.value));\n    }\n  }, [inputRest.value]);\n\n  useNativeFormResetListener(inputRef, () => {\n    setHasValue(Boolean(inputRest.defaultValue));\n  });\n\n  const renderIconButton: RenderIconButtonFn = (icon, props = {}) => (\n    <IconButton\n      hoverMode=\"opacity\"\n      onPointerDown={onIconClickStart}\n      className={styles.icon}\n      onFocus={setFocusedTrue}\n      onBlur={setFocusedFalse}\n      onClick={noop}\n      {...props}\n    >\n      <VisuallyHidden>{iconLabel}</VisuallyHidden>\n      {icon}\n    </IconButton>\n  );\n\n  const showControls = Boolean(\n    iconProp || !hideClearButton || (adaptiveSizeY.compact && onFindButtonClick),\n  );\n\n  return (\n    <RootComponent\n      baseClassName={classNames(\n        'vkuiInternalSearch',\n        styles.host,\n        sizeY === 'none' && styles.sizeYNone,\n        sizeY === 'compact' && styles.sizeYCompact,\n        isFocused && styles.focused,\n        hasValue && styles.hasValue,\n        hasAfter && styles.hasAfter,\n        iconProp && styles.hasIcon,\n        inputRest.disabled && styles.disabled,\n        !noPadding && styles.withPadding,\n        isRtl && styles.rtl,\n      )}\n      {...rootRest}\n    >\n      <div className={styles.field}>\n        <label htmlFor={inputId} className={styles.label}>\n          {placeholder}\n        </label>\n        <div className={styles.input}>\n          {before}\n          <Headline\n            Component=\"input\"\n            type=\"search\"\n            level=\"1\"\n            weight=\"3\"\n            id={inputId}\n            placeholder={placeholder}\n            autoComplete={autoComplete}\n            getRootRef={inputRef}\n            onChange={callMultiple(onChange, checkHasValue)}\n            onFocus={onFocus}\n            onBlur={onBlur}\n            {...inputRest}\n          />\n        </div>\n        {showControls && (\n          <div className={styles.controls}>\n            {iconProp &&\n              (typeof iconProp === 'function'\n                ? iconProp(renderIconButton)\n                : renderIconButton(iconProp))}\n            {!hideClearButton && (\n              <IconButton\n                hoverMode=\"opacity\"\n                onPointerDown={onIconCancelClickStart}\n                onClick={onCancel}\n                className={styles.icon}\n                tabIndex={hasValue ? undefined : -1}\n                disabled={inputProps.disabled}\n                data-testid={clearButtonTestId}\n              >\n                <VisuallyHidden>{clearLabel}</VisuallyHidden>\n                {platform === 'ios' ? <Icon16Clear /> : <Icon24Cancel />}\n              </IconButton>\n            )}\n            {adaptiveSizeY.compact && onFindButtonClick && (\n              <Button\n                mode=\"primary\"\n                size=\"m\"\n                className={classNames(styles.findButton, adaptiveSizeY.compact.className)}\n                focusVisibleMode=\"inside\"\n                onClick={onFindButtonClick}\n                tabIndex={hasValue ? undefined : -1}\n                data-testid={findButtonTestId}\n              >\n                {findButtonText}\n              </Button>\n            )}\n          </div>\n        )}\n      </div>\n      {hasAfter && (\n        <div className={styles.after}>\n          <Button\n            mode=\"tertiary\"\n            size=\"m\"\n            focusVisibleMode=\"inside\"\n            hoverMode=\"opacity\"\n            activeMode=\"opacity\"\n            onClick={onCancel}\n            onFocus={setFocusedTrue}\n            onBlur={setFocusedFalse}\n          >\n            <span className={styles.afterTextClip}>{after}</span>\n          </Button>\n        </div>\n      )}\n    </RootComponent>\n  );\n};\n"],"names":["React","Icon16Clear","Icon16SearchOutline","Icon24Cancel","classNames","hasReactNode","noop","useAdaptivity","useAdaptivityConditionalRender","useBooleanState","useConfigDirection","useExternRef","useMergeProps","useNativeFormResetListener","usePlatform","callMultiple","touchEnabled","useIsomorphicLayoutEffect","warnOnce","Button","IconButton","RootComponent","Headline","VisuallyHidden","styles","warn","Search","className","getRootRef","style","placeholder","placeholderProp","before","after","getRef","icon","iconProp","onIconClick","autoComplete","autoCompleteProp","iconLabel","clearLabel","clearButtonTestId","noPadding","findButtonText","findButtonTestId","onFindButtonClick","hideClearButton","slotProps","inputProps","process","env","NODE_ENV","direction","isRtl","rootRest","root","id","onChange","getInputRef","onFocus","onInputFocus","onBlur","onInputBlur","inputRest","nativeInput","input","inputRef","value","isFocused","setTrue","setFocusedTrue","setFalse","setFocusedFalse","generatedId","useId","inputId","hasValue","setHasValue","useState","Boolean","defaultValue","checkHasValue","e","currentTarget","sizeY","adaptiveSizeY","platform","hasAfter","onCancel","useCallback","nativeInputValueSetter","Object","getOwnPropertyDescriptor","HTMLInputElement","prototype","set","call","current","ev2","Event","bubbles","dispatchEvent","onIconClickStart","onIconCancelClickStart","preventDefault","focus","undefined","renderIconButton","props","hoverMode","onPointerDown","onClick","showControls","compact","baseClassName","host","sizeYNone","sizeYCompact","focused","hasIcon","disabled","withPadding","rtl","div","field","label","htmlFor","Component","type","level","weight","controls","tabIndex","data-testid","mode","size","findButton","focusVisibleMode","activeMode","span","afterTextClip"],"mappings":"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"}