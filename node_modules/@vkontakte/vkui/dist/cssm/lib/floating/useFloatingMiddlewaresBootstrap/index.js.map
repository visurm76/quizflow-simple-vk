{"version":3,"sources":["../../../../../src/lib/floating/useFloatingMiddlewaresBootstrap/index.ts"],"sourcesContent":["import * as React from 'react';\nimport {\n  arrowMiddleware,\n  autoPlacementMiddleware,\n  flipMiddleware,\n  type FlipMiddlewareOptions,\n  hideMiddleware,\n  offsetMiddleware,\n  shiftMiddleware,\n  type ShiftMiddlewareOptions,\n  sizeMiddleware,\n} from '../adapters';\nimport { checkIsNotAutoPlacement, getAutoPlacementAlign } from '../functions';\nimport {\n  type ArrowOptions,\n  type Placement,\n  type PlacementWithAuto,\n  type UseFloatingMiddleware,\n} from '../types/common';\n\nexport interface UseFloatingMiddlewaresBootstrapOptions {\n  /**\n   * По умолчанию компонент выберет наилучшее расположение сам, но приоритетное можно задать с помощью этого свойства.\n   */\n  placement?: PlacementWithAuto;\n  /**\n   * Указанное значение `placement` форсируется, даже если для выпадающего элемента недостаточно места.\n   * Не оказывает влияния при `placement` значениях - `'auto' | 'auto-start' | 'auto-end'`\n   */\n  disableFlipMiddleware?: boolean;\n  /**\n   * Позволяет отключить смещение по главной оси,\n   * которое не даёт всплывающему элементу выходить за границы видимой области.\n   */\n  disableShiftMiddleware?: boolean;\n  /**\n   * Задаёт резервный вариант размещения по перпендикулярной оси.\n   */\n  flipMiddlewareFallbackAxisSideDirection?: FlipMiddlewareOptions['fallbackAxisSideDirection'];\n  /**\n   * Отступ по главной оси.\n   */\n  offsetByMainAxis?: number;\n  /**\n   * Отступ по вспомогательной оси.\n   */\n  offsetByCrossAxis?: number;\n  /**\n   * Отступ для смещения.\n   */\n  overflowPadding?: ShiftMiddlewareOptions['padding'];\n  arrowRef?: ArrowOptions['element'];\n  /**\n   * Отображать ли стрелку, указывающую на якорный элемент.\n   */\n  arrow?: boolean;\n  /**\n   * Высота стрелки. Складывается с `mainAxis`, чтобы стрелка не залезала на якорный элемент.\n   */\n  arrowHeight?: number;\n  /**\n   * Безопасная зона вокруг стрелки, чтобы та не выходила за края контента.\n   */\n  arrowPadding?: number;\n  /**\n   * Выставлять ширину равной target элементу.\n   */\n  sameWidth?: boolean;\n  /**\n   * Позволяет задать или переопределить модификаторы библиотеки **Floating UI** (подробнее в документации про [middleware](https://floating-ui.com/docs/middleware)).\n   */\n  customMiddlewares?: UseFloatingMiddleware[];\n  /**\n   * Принудительно скрывает компонент если целевой элемент вышел за область видимости.\n   */\n  hideWhenReferenceHidden?: boolean;\n}\n\nexport const useFloatingMiddlewaresBootstrap = ({\n  placement = 'bottom-start',\n  arrowRef = null,\n  arrow,\n  arrowHeight,\n  arrowPadding,\n  sameWidth,\n  offsetByMainAxis = 0,\n  offsetByCrossAxis = 0,\n  customMiddlewares,\n  hideWhenReferenceHidden,\n  disableFlipMiddleware = false,\n  disableShiftMiddleware = false,\n  flipMiddlewareFallbackAxisSideDirection = 'end',\n  overflowPadding,\n}: UseFloatingMiddlewaresBootstrapOptions): {\n  middlewares: UseFloatingMiddleware[];\n  strictPlacement: Placement | undefined;\n} => {\n  return React.useMemo(() => {\n    const isAutoPlacement = !checkIsNotAutoPlacement(placement);\n    const middlewares: UseFloatingMiddleware[] = [\n      offsetMiddleware({\n        crossAxis: offsetByCrossAxis,\n        mainAxis: arrow && arrowHeight ? offsetByMainAxis + arrowHeight : offsetByMainAxis,\n      }),\n    ];\n\n    const shift = disableShiftMiddleware ? null : shiftMiddleware({ padding: overflowPadding });\n\n    // см. https://github.com/floating-ui/floating-ui/blob/%40floating-ui/core%401.7.1/website/pages/docs/flip.mdx#conflict-with-autoplacementjs\n    if (isAutoPlacement) {\n      middlewares.push(autoPlacementMiddleware({ alignment: getAutoPlacementAlign(placement) }));\n      if (shift) {\n        middlewares.push(shift);\n      }\n    } else if (!disableFlipMiddleware) {\n      const flip = flipMiddleware({\n        crossAxis: 'alignment',\n        fallbackAxisSideDirection: flipMiddlewareFallbackAxisSideDirection,\n      });\n\n      // см. https://github.com/floating-ui/floating-ui/blob/%40floating-ui/core%401.7.1/website/pages/docs/flip.mdx#combining-with-shiftjs\n      if (placement.includes('-')) {\n        middlewares.push(flip);\n        if (shift) {\n          middlewares.push(shift);\n        }\n      } else {\n        if (shift) {\n          middlewares.push(shift);\n        }\n        middlewares.push(flip);\n      }\n    } else if (shift) {\n      middlewares.push(shift);\n    }\n\n    if (sameWidth) {\n      middlewares.push(\n        sizeMiddleware({\n          apply({ rects, elements }) {\n            Object.assign(elements.floating.style, {\n              width: `${rects.reference.width}px`,\n            });\n          },\n        }),\n      );\n    }\n\n    if (customMiddlewares) {\n      middlewares.push(...customMiddlewares);\n    }\n\n    // см. https://github.com/floating-ui/floating-ui/blob/%40floating-ui/core%401.7.1/website/pages/docs/arrow.mdx#order\n    if (arrow) {\n      middlewares.push(\n        arrowMiddleware({\n          element: arrowRef,\n          padding: arrowPadding,\n        }),\n      );\n    }\n\n    if (hideWhenReferenceHidden) {\n      middlewares.push(hideMiddleware());\n    }\n\n    return { middlewares, strictPlacement: isAutoPlacement ? undefined : placement };\n  }, [\n    placement,\n    offsetByCrossAxis,\n    arrow,\n    arrowHeight,\n    offsetByMainAxis,\n    disableFlipMiddleware,\n    disableShiftMiddleware,\n    flipMiddlewareFallbackAxisSideDirection,\n    sameWidth,\n    customMiddlewares,\n    hideWhenReferenceHidden,\n    arrowRef,\n    arrowPadding,\n    overflowPadding,\n  ]);\n};\n"],"names":["React","arrowMiddleware","autoPlacementMiddleware","flipMiddleware","hideMiddleware","offsetMiddleware","shiftMiddleware","sizeMiddleware","checkIsNotAutoPlacement","getAutoPlacementAlign","useFloatingMiddlewaresBootstrap","placement","arrowRef","arrow","arrowHeight","arrowPadding","sameWidth","offsetByMainAxis","offsetByCrossAxis","customMiddlewares","hideWhenReferenceHidden","disableFlipMiddleware","disableShiftMiddleware","flipMiddlewareFallbackAxisSideDirection","overflowPadding","useMemo","isAutoPlacement","middlewares","crossAxis","mainAxis","shift","padding","push","alignment","flip","fallbackAxisSideDirection","includes","apply","rects","elements","Object","assign","floating","style","width","reference","element","strictPlacement","undefined"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SACEC,eAAe,EACfC,uBAAuB,EACvBC,cAAc,EAEdC,cAAc,EACdC,gBAAgB,EAChBC,eAAe,EAEfC,cAAc,QACT,iBAAc;AACrB,SAASC,uBAAuB,EAAEC,qBAAqB,QAAQ,kBAAe;AAkE9E,OAAO,MAAMC,kCAAkC,CAAC,EAC9CC,YAAY,cAAc,EAC1BC,WAAW,IAAI,EACfC,KAAK,EACLC,WAAW,EACXC,YAAY,EACZC,SAAS,EACTC,mBAAmB,CAAC,EACpBC,oBAAoB,CAAC,EACrBC,iBAAiB,EACjBC,uBAAuB,EACvBC,wBAAwB,KAAK,EAC7BC,yBAAyB,KAAK,EAC9BC,0CAA0C,KAAK,EAC/CC,eAAe,EACwB;IAIvC,OAAOxB,MAAMyB,OAAO,CAAC;QACnB,MAAMC,kBAAkB,CAAClB,wBAAwBG;QACjD,MAAMgB,cAAuC;YAC3CtB,iBAAiB;gBACfuB,WAAWV;gBACXW,UAAUhB,SAASC,cAAcG,mBAAmBH,cAAcG;YACpE;SACD;QAED,MAAMa,QAAQR,yBAAyB,OAAOhB,gBAAgB;YAAEyB,SAASP;QAAgB;QAEzF,4IAA4I;QAC5I,IAAIE,iBAAiB;YACnBC,YAAYK,IAAI,CAAC9B,wBAAwB;gBAAE+B,WAAWxB,sBAAsBE;YAAW;YACvF,IAAImB,OAAO;gBACTH,YAAYK,IAAI,CAACF;YACnB;QACF,OAAO,IAAI,CAACT,uBAAuB;YACjC,MAAMa,OAAO/B,eAAe;gBAC1ByB,WAAW;gBACXO,2BAA2BZ;YAC7B;YAEA,qIAAqI;YACrI,IAAIZ,UAAUyB,QAAQ,CAAC,MAAM;gBAC3BT,YAAYK,IAAI,CAACE;gBACjB,IAAIJ,OAAO;oBACTH,YAAYK,IAAI,CAACF;gBACnB;YACF,OAAO;gBACL,IAAIA,OAAO;oBACTH,YAAYK,IAAI,CAACF;gBACnB;gBACAH,YAAYK,IAAI,CAACE;YACnB;QACF,OAAO,IAAIJ,OAAO;YAChBH,YAAYK,IAAI,CAACF;QACnB;QAEA,IAAId,WAAW;YACbW,YAAYK,IAAI,CACdzB,eAAe;gBACb8B,OAAM,EAAEC,KAAK,EAAEC,QAAQ,EAAE;oBACvBC,OAAOC,MAAM,CAACF,SAASG,QAAQ,CAACC,KAAK,EAAE;wBACrCC,OAAO,GAAGN,MAAMO,SAAS,CAACD,KAAK,CAAC,EAAE,CAAC;oBACrC;gBACF;YACF;QAEJ;QAEA,IAAIzB,mBAAmB;YACrBQ,YAAYK,IAAI,IAAIb;QACtB;QAEA,qHAAqH;QACrH,IAAIN,OAAO;YACTc,YAAYK,IAAI,CACd/B,gBAAgB;gBACd6C,SAASlC;gBACTmB,SAAShB;YACX;QAEJ;QAEA,IAAIK,yBAAyB;YAC3BO,YAAYK,IAAI,CAAC5B;QACnB;QAEA,OAAO;YAAEuB;YAAaoB,iBAAiBrB,kBAAkBsB,YAAYrC;QAAU;IACjF,GAAG;QACDA;QACAO;QACAL;QACAC;QACAG;QACAI;QACAC;QACAC;QACAP;QACAG;QACAC;QACAR;QACAG;QACAS;KACD;AACH,EAAE"}